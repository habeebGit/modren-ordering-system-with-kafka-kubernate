time="2026-02-26T05:26:38-06:00" level=warning msg="/Users/habeebmohammed/software/modren-ordering-system-with-kafka-kubernate/modren-ordering-system-with-kafka/docker-compose.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion"
product-service-1  | 
product-service-1  | > product-service@1.0.0 start
product-service-1  | > node index.js
product-service-1  | 
product-service-1  | [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild
product-service-1  | {"level":"WARN","timestamp":"2026-02-25T17:52:40.488Z","logger":"kafkajs","message":"KafkaJS v2.0.0 switched default partitioner. To retain the same partitioning behavior as in previous versions, create the producer with the option \"createPartitioner: Partitioners.LegacyPartitioner\". See the migration guide at https://kafka.js.org/docs/migration-guide-v2.0.0#producer-new-default-partitioner for details. Silence this warning by setting the environment variable \"KAFKAJS_NO_PARTITIONER_WARNING=1\""}
product-service-1  | Product Service running on port 3002
product-service-1  | Executing (default): SELECT 1+1 AS result
product-service-1  | Database connected successfully
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'Products'
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'Products' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'Products' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "name" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "name" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "name" TYPE VARCHAR(255);
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "stock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "stock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "stock" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "reservedStock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "reservedStock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "reservedStock" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "version" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "version" SET DEFAULT 1;ALTER TABLE "Products" ALTER COLUMN "version" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'Products' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'StockReservations'
product-service-1  | Executing (default): SELECT t.typname enum_name, array_agg(e.enumlabel ORDER BY enumsortorder) enum_value FROM pg_type t JOIN pg_enum e ON t.oid = e.enumtypid JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace WHERE n.nspname = 'public' AND t.typname='enum_StockReservations_status' GROUP BY 1
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'StockReservations' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'StockReservations' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "orderId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "orderId" DROP DEFAULT;ALTER TABLE "StockReservations"  ADD UNIQUE ("orderId");ALTER TABLE "StockReservations" ALTER COLUMN "orderId" TYPE INTEGER  ;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "productId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "productId" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "productId" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "quantity" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "status" DROP NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "status" SET DEFAULT 'RESERVED';DO 'BEGIN CREATE TYPE "public"."enum_StockReservations_status" AS ENUM(''RESERVED'', ''CONFIRMED'', ''RELEASED''); EXCEPTION WHEN duplicate_object THEN null; END';ALTER TABLE "StockReservations" ALTER COLUMN "status" TYPE "public"."enum_StockReservations_status" USING ("status"::"public"."enum_StockReservations_status");
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" DROP CONSTRAINT "StockReservations_ProductId_fkey"
product-service-1  | Executing (default): ALTER TABLE "StockReservations"  ADD FOREIGN KEY ("ProductId") REFERENCES "Products" ("id") ON DELETE SET NULL ON UPDATE CASCADE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'StockReservations' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'ProcessedEvents'
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'ProcessedEvents' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'ProcessedEvents' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" TYPE VARCHAR(255);
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'ProcessedEvents' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Database synced
product-service-1  | Kafka producer connected for product-service
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T17:52:40.722Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T17:53:09.536Z","logger":"kafkajs","message":"[ConsumerGroup] Consumer has joined the group","groupId":"product-group","memberId":"kafkajs-3669773c-534e-424c-8009-c55e18e955a0","leaderId":"kafkajs-3669773c-534e-424c-8009-c55e18e955a0","isLeader":true,"memberAssignment":{"order-events":[0]},"groupProtocol":"RoundRobinAssigner","duration":28814}
product-service-1  | Attempt 1 to start Kafka client failed, retrying in 1000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 2 to start Kafka client failed, retrying in 2000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 3 to start Kafka client failed, retrying in 4000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 4 to start Kafka client failed, retrying in 8000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 5 to start Kafka client failed, retrying in 16000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 6 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 7 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Executing (default): SELECT "id", "name", "stock", "reservedStock", "version", "createdAt", "updatedAt" FROM "Products" AS "Product";
product-service-1  | Executing (default): SELECT "id", "name", "stock", "reservedStock", "version", "createdAt", "updatedAt" FROM "Products" AS "Product";
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 8 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Failed to start Kafka consumer after retries { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Error starting Kafka consumer: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
product-service-1  |     at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
product-service-1  |     at startKafkaConsumer (/app/index.js:498:24)
product-service-1  |     at async start (/app/index.js:538:5) {
product-service-1  |   retriable: false,
product-service-1  |   helpUrl: undefined,
product-service-1  |   [cause]: undefined
product-service-1  | }
product-service-1  | Startup error: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
product-service-1  |     at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
product-service-1  |     at startKafkaConsumer (/app/index.js:498:24)
product-service-1  |     at async start (/app/index.js:538:5) {
product-service-1  |   retriable: false,
product-service-1  |   helpUrl: undefined,
product-service-1  |   [cause]: undefined
product-service-1  | }
product-service-1  | npm notice
product-service-1  | npm notice New major version of npm available! 10.8.2 -> 11.10.1
product-service-1  | npm notice Changelog: https://github.com/npm/cli/releases/tag/v11.10.1
product-service-1  | npm notice To update run: npm install -g npm@11.10.1
product-service-1  | npm notice
product-service-1  | 
product-service-1  | > product-service@1.0.0 start
product-service-1  | > node index.js
product-service-1  | 
product-service-1  | [dotenv@17.2.3] injecting env (0) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops
product-service-1  | {"level":"WARN","timestamp":"2026-02-25T17:54:41.544Z","logger":"kafkajs","message":"KafkaJS v2.0.0 switched default partitioner. To retain the same partitioning behavior as in previous versions, create the producer with the option \"createPartitioner: Partitioners.LegacyPartitioner\". See the migration guide at https://kafka.js.org/docs/migration-guide-v2.0.0#producer-new-default-partitioner for details. Silence this warning by setting the environment variable \"KAFKAJS_NO_PARTITIONER_WARNING=1\""}
product-service-1  | Product Service running on port 3002
product-service-1  | Executing (default): SELECT 1+1 AS result
product-service-1  | Database connected successfully
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'Products'
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'Products' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'Products' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "name" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "name" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "name" TYPE VARCHAR(255);
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "stock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "stock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "stock" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "reservedStock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "reservedStock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "reservedStock" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "version" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "version" SET DEFAULT 1;ALTER TABLE "Products" ALTER COLUMN "version" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'Products' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'StockReservations'
product-service-1  | Executing (default): SELECT t.typname enum_name, array_agg(e.enumlabel ORDER BY enumsortorder) enum_value FROM pg_type t JOIN pg_enum e ON t.oid = e.enumtypid JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace WHERE n.nspname = 'public' AND t.typname='enum_StockReservations_status' GROUP BY 1
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'StockReservations' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'StockReservations' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "orderId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "orderId" DROP DEFAULT;ALTER TABLE "StockReservations"  ADD UNIQUE ("orderId");ALTER TABLE "StockReservations" ALTER COLUMN "orderId" TYPE INTEGER  ;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "productId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "productId" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "productId" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "quantity" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "status" DROP NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "status" SET DEFAULT 'RESERVED';DO 'BEGIN CREATE TYPE "public"."enum_StockReservations_status" AS ENUM(''RESERVED'', ''CONFIRMED'', ''RELEASED''); EXCEPTION WHEN duplicate_object THEN null; END';ALTER TABLE "StockReservations" ALTER COLUMN "status" TYPE "public"."enum_StockReservations_status" USING ("status"::"public"."enum_StockReservations_status");
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" DROP CONSTRAINT "StockReservations_ProductId_fkey"
product-service-1  | Executing (default): ALTER TABLE "StockReservations"  ADD FOREIGN KEY ("ProductId") REFERENCES "Products" ("id") ON DELETE SET NULL ON UPDATE CASCADE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'StockReservations' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'ProcessedEvents'
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'ProcessedEvents' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'ProcessedEvents' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" TYPE VARCHAR(255);
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'ProcessedEvents' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Database synced
product-service-1  | Kafka producer connected for product-service
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T17:54:41.677Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T17:55:05.712Z","logger":"kafkajs","message":"[ConsumerGroup] Consumer has joined the group","groupId":"product-group","memberId":"kafkajs-c032c3c0-d1d9-45ad-b5f1-037b797eddd9","leaderId":"kafkajs-c032c3c0-d1d9-45ad-b5f1-037b797eddd9","isLeader":true,"memberAssignment":{"order-events":[0]},"groupProtocol":"RoundRobinAssigner","duration":24034}
product-service-1  | Attempt 1 to start Kafka client failed, retrying in 1000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 2 to start Kafka client failed, retrying in 2000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 3 to start Kafka client failed, retrying in 4000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 4 to start Kafka client failed, retrying in 8000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 5 to start Kafka client failed, retrying in 16000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 6 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 7 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 8 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Failed to start Kafka consumer after retries { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Error starting Kafka consumer: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
product-service-1  |     at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
product-service-1  |     at startKafkaConsumer (/app/index.js:498:24)
product-service-1  |     at runNextTicks (node:internal/process/task_queues:60:5)
product-service-1  |     at process.processTimers (node:internal/timers:509:9)
product-service-1  |     at async start (/app/index.js:538:5) {
product-service-1  |   retriable: false,
product-service-1  |   helpUrl: undefined,
product-service-1  |   [cause]: undefined
product-service-1  | }
product-service-1  | Startup error: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
product-service-1  |     at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
product-service-1  |     at startKafkaConsumer (/app/index.js:498:24)
product-service-1  |     at runNextTicks (node:internal/process/task_queues:60:5)
product-service-1  |     at process.processTimers (node:internal/timers:509:9)
product-service-1  |     at async start (/app/index.js:538:5) {
product-service-1  |   retriable: false,
product-service-1  |   helpUrl: undefined,
product-service-1  |   [cause]: undefined
product-service-1  | }
product-service-1  | 
product-service-1  | > product-service@1.0.0 start
product-service-1  | > node index.js
product-service-1  | 
product-service-1  | [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }
product-service-1  | {"level":"WARN","timestamp":"2026-02-25T17:56:37.750Z","logger":"kafkajs","message":"KafkaJS v2.0.0 switched default partitioner. To retain the same partitioning behavior as in previous versions, create the producer with the option \"createPartitioner: Partitioners.LegacyPartitioner\". See the migration guide at https://kafka.js.org/docs/migration-guide-v2.0.0#producer-new-default-partitioner for details. Silence this warning by setting the environment variable \"KAFKAJS_NO_PARTITIONER_WARNING=1\""}
product-service-1  | Product Service running on port 3002
product-service-1  | Executing (default): SELECT 1+1 AS result
product-service-1  | Database connected successfully
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'Products'
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'Products' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'Products' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "name" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "name" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "name" TYPE VARCHAR(255);
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "stock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "stock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "stock" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "reservedStock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "reservedStock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "reservedStock" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "version" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "version" SET DEFAULT 1;ALTER TABLE "Products" ALTER COLUMN "version" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'Products' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'StockReservations'
product-service-1  | Executing (default): SELECT t.typname enum_name, array_agg(e.enumlabel ORDER BY enumsortorder) enum_value FROM pg_type t JOIN pg_enum e ON t.oid = e.enumtypid JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace WHERE n.nspname = 'public' AND t.typname='enum_StockReservations_status' GROUP BY 1
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'StockReservations' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'StockReservations' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "orderId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "orderId" DROP DEFAULT;ALTER TABLE "StockReservations"  ADD UNIQUE ("orderId");ALTER TABLE "StockReservations" ALTER COLUMN "orderId" TYPE INTEGER  ;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "productId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "productId" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "productId" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "quantity" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "status" DROP NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "status" SET DEFAULT 'RESERVED';DO 'BEGIN CREATE TYPE "public"."enum_StockReservations_status" AS ENUM(''RESERVED'', ''CONFIRMED'', ''RELEASED''); EXCEPTION WHEN duplicate_object THEN null; END';ALTER TABLE "StockReservations" ALTER COLUMN "status" TYPE "public"."enum_StockReservations_status" USING ("status"::"public"."enum_StockReservations_status");
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" DROP CONSTRAINT "StockReservations_ProductId_fkey"
product-service-1  | Executing (default): ALTER TABLE "StockReservations"  ADD FOREIGN KEY ("ProductId") REFERENCES "Products" ("id") ON DELETE SET NULL ON UPDATE CASCADE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'StockReservations' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'ProcessedEvents'
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'ProcessedEvents' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'ProcessedEvents' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" TYPE VARCHAR(255);
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'ProcessedEvents' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Database synced
product-service-1  | Kafka producer connected for product-service
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T17:56:37.920Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T17:57:06.593Z","logger":"kafkajs","message":"[ConsumerGroup] Consumer has joined the group","groupId":"product-group","memberId":"kafkajs-e15f1051-323b-4ce3-8e67-64cb597e588b","leaderId":"kafkajs-e15f1051-323b-4ce3-8e67-64cb597e588b","isLeader":true,"memberAssignment":{"order-events":[0]},"groupProtocol":"RoundRobinAssigner","duration":28672}
product-service-1  | Attempt 1 to start Kafka client failed, retrying in 1000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 2 to start Kafka client failed, retrying in 2000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 3 to start Kafka client failed, retrying in 4000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 4 to start Kafka client failed, retrying in 8000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 5 to start Kafka client failed, retrying in 16000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 6 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 7 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 8 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Failed to start Kafka consumer after retries { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Error starting Kafka consumer: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
product-service-1  |     at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
product-service-1  |     at startKafkaConsumer (/app/index.js:498:24)
product-service-1  |     at runNextTicks (node:internal/process/task_queues:60:5)
product-service-1  |     at process.processTimers (node:internal/timers:509:9)
product-service-1  |     at async start (/app/index.js:538:5) {
product-service-1  |   retriable: false,
product-service-1  |   helpUrl: undefined,
product-service-1  |   [cause]: undefined
product-service-1  | }
product-service-1  | Startup error: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
product-service-1  |     at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
product-service-1  |     at startKafkaConsumer (/app/index.js:498:24)
product-service-1  |     at runNextTicks (node:internal/process/task_queues:60:5)
product-service-1  |     at process.processTimers (node:internal/timers:509:9)
product-service-1  |     at async start (/app/index.js:538:5) {
product-service-1  |   retriable: false,
product-service-1  |   helpUrl: undefined,
product-service-1  |   [cause]: undefined
product-service-1  | }
product-service-1  | 
product-service-1  | > product-service@1.0.0 start
product-service-1  | > node index.js
product-service-1  | 
product-service-1  | [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com
product-service-1  | {"level":"WARN","timestamp":"2026-02-25T17:58:38.466Z","logger":"kafkajs","message":"KafkaJS v2.0.0 switched default partitioner. To retain the same partitioning behavior as in previous versions, create the producer with the option \"createPartitioner: Partitioners.LegacyPartitioner\". See the migration guide at https://kafka.js.org/docs/migration-guide-v2.0.0#producer-new-default-partitioner for details. Silence this warning by setting the environment variable \"KAFKAJS_NO_PARTITIONER_WARNING=1\""}
product-service-1  | Product Service running on port 3002
product-service-1  | Executing (default): SELECT 1+1 AS result
product-service-1  | Database connected successfully
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'Products'
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'Products' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'Products' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "name" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "name" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "name" TYPE VARCHAR(255);
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "stock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "stock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "stock" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "reservedStock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "reservedStock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "reservedStock" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "version" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "version" SET DEFAULT 1;ALTER TABLE "Products" ALTER COLUMN "version" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'Products' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'StockReservations'
product-service-1  | Executing (default): SELECT t.typname enum_name, array_agg(e.enumlabel ORDER BY enumsortorder) enum_value FROM pg_type t JOIN pg_enum e ON t.oid = e.enumtypid JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace WHERE n.nspname = 'public' AND t.typname='enum_StockReservations_status' GROUP BY 1
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'StockReservations' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'StockReservations' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "orderId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "orderId" DROP DEFAULT;ALTER TABLE "StockReservations"  ADD UNIQUE ("orderId");ALTER TABLE "StockReservations" ALTER COLUMN "orderId" TYPE INTEGER  ;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "productId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "productId" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "productId" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "quantity" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "status" DROP NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "status" SET DEFAULT 'RESERVED';DO 'BEGIN CREATE TYPE "public"."enum_StockReservations_status" AS ENUM(''RESERVED'', ''CONFIRMED'', ''RELEASED''); EXCEPTION WHEN duplicate_object THEN null; END';ALTER TABLE "StockReservations" ALTER COLUMN "status" TYPE "public"."enum_StockReservations_status" USING ("status"::"public"."enum_StockReservations_status");
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" DROP CONSTRAINT "StockReservations_ProductId_fkey"
product-service-1  | Executing (default): ALTER TABLE "StockReservations"  ADD FOREIGN KEY ("ProductId") REFERENCES "Products" ("id") ON DELETE SET NULL ON UPDATE CASCADE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'StockReservations' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'ProcessedEvents'
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'ProcessedEvents' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'ProcessedEvents' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" TYPE VARCHAR(255);
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'ProcessedEvents' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Database synced
product-service-1  | Kafka producer connected for product-service
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T17:58:38.591Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T17:59:07.302Z","logger":"kafkajs","message":"[ConsumerGroup] Consumer has joined the group","groupId":"product-group","memberId":"kafkajs-4ff0c1f7-ec36-4449-9b77-ca238a4a25b1","leaderId":"kafkajs-4ff0c1f7-ec36-4449-9b77-ca238a4a25b1","isLeader":true,"memberAssignment":{"order-events":[0]},"groupProtocol":"RoundRobinAssigner","duration":28710}
product-service-1  | Attempt 1 to start Kafka client failed, retrying in 1000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 2 to start Kafka client failed, retrying in 2000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 3 to start Kafka client failed, retrying in 4000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 4 to start Kafka client failed, retrying in 8000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 5 to start Kafka client failed, retrying in 16000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 6 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 7 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 8 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Failed to start Kafka consumer after retries { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Error starting Kafka consumer: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
product-service-1  |     at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
product-service-1  |     at startKafkaConsumer (/app/index.js:498:24)
product-service-1  |     at runNextTicks (node:internal/process/task_queues:60:5)
product-service-1  |     at process.processTimers (node:internal/timers:509:9)
product-service-1  |     at async start (/app/index.js:538:5) {
product-service-1  |   retriable: false,
product-service-1  |   helpUrl: undefined,
product-service-1  |   [cause]: undefined
product-service-1  | }
product-service-1  | Startup error: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
product-service-1  |     at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
product-service-1  |     at startKafkaConsumer (/app/index.js:498:24)
product-service-1  |     at runNextTicks (node:internal/process/task_queues:60:5)
product-service-1  |     at process.processTimers (node:internal/timers:509:9)
product-service-1  |     at async start (/app/index.js:538:5) {
product-service-1  |   retriable: false,
product-service-1  |   helpUrl: undefined,
product-service-1  |   [cause]: undefined
product-service-1  | }
product-service-1  | 
product-service-1  | > product-service@1.0.0 start
product-service-1  | > node index.js
product-service-1  | 
product-service-1  | [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }
product-service-1  | {"level":"WARN","timestamp":"2026-02-25T18:00:39.087Z","logger":"kafkajs","message":"KafkaJS v2.0.0 switched default partitioner. To retain the same partitioning behavior as in previous versions, create the producer with the option \"createPartitioner: Partitioners.LegacyPartitioner\". See the migration guide at https://kafka.js.org/docs/migration-guide-v2.0.0#producer-new-default-partitioner for details. Silence this warning by setting the environment variable \"KAFKAJS_NO_PARTITIONER_WARNING=1\""}
product-service-1  | Product Service running on port 3002
product-service-1  | Executing (default): SELECT 1+1 AS result
product-service-1  | Database connected successfully
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'Products'
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'Products' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'Products' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "name" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "name" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "name" TYPE VARCHAR(255);
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "stock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "stock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "stock" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "reservedStock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "reservedStock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "reservedStock" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "version" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "version" SET DEFAULT 1;ALTER TABLE "Products" ALTER COLUMN "version" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'Products' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'StockReservations'
product-service-1  | Executing (default): SELECT t.typname enum_name, array_agg(e.enumlabel ORDER BY enumsortorder) enum_value FROM pg_type t JOIN pg_enum e ON t.oid = e.enumtypid JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace WHERE n.nspname = 'public' AND t.typname='enum_StockReservations_status' GROUP BY 1
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'StockReservations' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'StockReservations' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "orderId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "orderId" DROP DEFAULT;ALTER TABLE "StockReservations"  ADD UNIQUE ("orderId");ALTER TABLE "StockReservations" ALTER COLUMN "orderId" TYPE INTEGER  ;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "productId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "productId" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "productId" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "quantity" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "status" DROP NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "status" SET DEFAULT 'RESERVED';DO 'BEGIN CREATE TYPE "public"."enum_StockReservations_status" AS ENUM(''RESERVED'', ''CONFIRMED'', ''RELEASED''); EXCEPTION WHEN duplicate_object THEN null; END';ALTER TABLE "StockReservations" ALTER COLUMN "status" TYPE "public"."enum_StockReservations_status" USING ("status"::"public"."enum_StockReservations_status");
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" DROP CONSTRAINT "StockReservations_ProductId_fkey"
product-service-1  | Executing (default): ALTER TABLE "StockReservations"  ADD FOREIGN KEY ("ProductId") REFERENCES "Products" ("id") ON DELETE SET NULL ON UPDATE CASCADE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'StockReservations' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'ProcessedEvents'
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'ProcessedEvents' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'ProcessedEvents' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" TYPE VARCHAR(255);
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'ProcessedEvents' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Database synced
product-service-1  | Kafka producer connected for product-service
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T18:00:39.231Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T18:01:08.285Z","logger":"kafkajs","message":"[ConsumerGroup] Consumer has joined the group","groupId":"product-group","memberId":"kafkajs-b4fc0b1d-4979-4c9f-a535-6a8f353f01c9","leaderId":"kafkajs-b4fc0b1d-4979-4c9f-a535-6a8f353f01c9","isLeader":true,"memberAssignment":{"order-events":[0]},"groupProtocol":"RoundRobinAssigner","duration":29053}
product-service-1  | Attempt 1 to start Kafka client failed, retrying in 1000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 2 to start Kafka client failed, retrying in 2000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 3 to start Kafka client failed, retrying in 4000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 4 to start Kafka client failed, retrying in 8000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 5 to start Kafka client failed, retrying in 16000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 6 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 7 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 8 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Failed to start Kafka consumer after retries { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Error starting Kafka consumer: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
product-service-1  |     at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
product-service-1  |     at startKafkaConsumer (/app/index.js:498:24)
product-service-1  |     at runNextTicks (node:internal/process/task_queues:60:5)
product-service-1  |     at process.processTimers (node:internal/timers:509:9)
product-service-1  |     at async start (/app/index.js:538:5) {
product-service-1  |   retriable: false,
product-service-1  |   helpUrl: undefined,
product-service-1  |   [cause]: undefined
product-service-1  | }
product-service-1  | Startup error: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
product-service-1  |     at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
product-service-1  |     at startKafkaConsumer (/app/index.js:498:24)
product-service-1  |     at runNextTicks (node:internal/process/task_queues:60:5)
product-service-1  |     at process.processTimers (node:internal/timers:509:9)
product-service-1  |     at async start (/app/index.js:538:5) {
product-service-1  |   retriable: false,
product-service-1  |   helpUrl: undefined,
product-service-1  |   [cause]: undefined
product-service-1  | }
product-service-1  | 
product-service-1  | > product-service@1.0.0 start
product-service-1  | > node index.js
product-service-1  | 
product-service-1  | [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }
product-service-1  | {"level":"WARN","timestamp":"2026-02-25T18:02:40.228Z","logger":"kafkajs","message":"KafkaJS v2.0.0 switched default partitioner. To retain the same partitioning behavior as in previous versions, create the producer with the option \"createPartitioner: Partitioners.LegacyPartitioner\". See the migration guide at https://kafka.js.org/docs/migration-guide-v2.0.0#producer-new-default-partitioner for details. Silence this warning by setting the environment variable \"KAFKAJS_NO_PARTITIONER_WARNING=1\""}
product-service-1  | Product Service running on port 3002
product-service-1  | Executing (default): SELECT 1+1 AS result
product-service-1  | Database connected successfully
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'Products'
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'Products' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'Products' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "name" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "name" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "name" TYPE VARCHAR(255);
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "stock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "stock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "stock" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "reservedStock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "reservedStock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "reservedStock" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "version" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "version" SET DEFAULT 1;ALTER TABLE "Products" ALTER COLUMN "version" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'Products' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'StockReservations'
product-service-1  | Executing (default): SELECT t.typname enum_name, array_agg(e.enumlabel ORDER BY enumsortorder) enum_value FROM pg_type t JOIN pg_enum e ON t.oid = e.enumtypid JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace WHERE n.nspname = 'public' AND t.typname='enum_StockReservations_status' GROUP BY 1
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'StockReservations' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'StockReservations' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "orderId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "orderId" DROP DEFAULT;ALTER TABLE "StockReservations"  ADD UNIQUE ("orderId");ALTER TABLE "StockReservations" ALTER COLUMN "orderId" TYPE INTEGER  ;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "productId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "productId" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "productId" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "quantity" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "status" DROP NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "status" SET DEFAULT 'RESERVED';DO 'BEGIN CREATE TYPE "public"."enum_StockReservations_status" AS ENUM(''RESERVED'', ''CONFIRMED'', ''RELEASED''); EXCEPTION WHEN duplicate_object THEN null; END';ALTER TABLE "StockReservations" ALTER COLUMN "status" TYPE "public"."enum_StockReservations_status" USING ("status"::"public"."enum_StockReservations_status");
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" DROP CONSTRAINT "StockReservations_ProductId_fkey"
product-service-1  | Executing (default): ALTER TABLE "StockReservations"  ADD FOREIGN KEY ("ProductId") REFERENCES "Products" ("id") ON DELETE SET NULL ON UPDATE CASCADE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'StockReservations' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'ProcessedEvents'
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'ProcessedEvents' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'ProcessedEvents' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" TYPE VARCHAR(255);
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'ProcessedEvents' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Database synced
product-service-1  | Kafka producer connected for product-service
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T18:02:40.360Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T18:03:09.032Z","logger":"kafkajs","message":"[ConsumerGroup] Consumer has joined the group","groupId":"product-group","memberId":"kafkajs-8a03ec4f-bfad-4719-9eba-a5c56ef7c3f7","leaderId":"kafkajs-8a03ec4f-bfad-4719-9eba-a5c56ef7c3f7","isLeader":true,"memberAssignment":{"order-events":[0]},"groupProtocol":"RoundRobinAssigner","duration":28671}
product-service-1  | Attempt 1 to start Kafka client failed, retrying in 1000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 2 to start Kafka client failed, retrying in 2000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 3 to start Kafka client failed, retrying in 4000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 4 to start Kafka client failed, retrying in 8000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 5 to start Kafka client failed, retrying in 16000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 6 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | npm error path /app
product-service-1  | npm error command failed
product-service-1  | npm error signal SIGTERM
product-service-1  | npm error command sh -c node index.js
product-service-1  | npm error A complete log of this run can be found in: /home/nodejs/.npm/_logs/2026-02-25T18_02_39_849Z-debug-0.log
product-service-1  | 
product-service-1  | > product-service@1.0.0 start
product-service-1  | > node index.js
product-service-1  | 
product-service-1  | [dotenv@17.2.3] injecting env (0) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops
product-service-1  | {"level":"WARN","timestamp":"2026-02-25T18:03:45.354Z","logger":"kafkajs","message":"KafkaJS v2.0.0 switched default partitioner. To retain the same partitioning behavior as in previous versions, create the producer with the option \"createPartitioner: Partitioners.LegacyPartitioner\". See the migration guide at https://kafka.js.org/docs/migration-guide-v2.0.0#producer-new-default-partitioner for details. Silence this warning by setting the environment variable \"KAFKAJS_NO_PARTITIONER_WARNING=1\""}
product-service-1  | Product Service running on port 3002
product-service-1  | Executing (default): SELECT 1+1 AS result
product-service-1  | Database connected successfully
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'Products'
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'Products' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'Products' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "name" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "name" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "name" TYPE VARCHAR(255);
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "stock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "stock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "stock" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "reservedStock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "reservedStock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "reservedStock" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "version" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "version" SET DEFAULT 1;ALTER TABLE "Products" ALTER COLUMN "version" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'Products' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'StockReservations'
product-service-1  | Executing (default): SELECT t.typname enum_name, array_agg(e.enumlabel ORDER BY enumsortorder) enum_value FROM pg_type t JOIN pg_enum e ON t.oid = e.enumtypid JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace WHERE n.nspname = 'public' AND t.typname='enum_StockReservations_status' GROUP BY 1
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'StockReservations' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'StockReservations' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "orderId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "orderId" DROP DEFAULT;ALTER TABLE "StockReservations"  ADD UNIQUE ("orderId");ALTER TABLE "StockReservations" ALTER COLUMN "orderId" TYPE INTEGER  ;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "productId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "productId" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "productId" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "quantity" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "status" DROP NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "status" SET DEFAULT 'RESERVED';DO 'BEGIN CREATE TYPE "public"."enum_StockReservations_status" AS ENUM(''RESERVED'', ''CONFIRMED'', ''RELEASED''); EXCEPTION WHEN duplicate_object THEN null; END';ALTER TABLE "StockReservations" ALTER COLUMN "status" TYPE "public"."enum_StockReservations_status" USING ("status"::"public"."enum_StockReservations_status");
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" DROP CONSTRAINT "StockReservations_ProductId_fkey"
product-service-1  | Executing (default): ALTER TABLE "StockReservations"  ADD FOREIGN KEY ("ProductId") REFERENCES "Products" ("id") ON DELETE SET NULL ON UPDATE CASCADE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'StockReservations' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'ProcessedEvents'
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'ProcessedEvents' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'ProcessedEvents' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" TYPE VARCHAR(255);
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'ProcessedEvents' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Database synced
product-service-1  | Kafka producer connected for product-service
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T18:03:45.473Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T18:04:09.351Z","logger":"kafkajs","message":"[ConsumerGroup] Consumer has joined the group","groupId":"product-group","memberId":"kafkajs-901f4559-c5a0-4ba7-92f9-53e40b4b02f9","leaderId":"kafkajs-901f4559-c5a0-4ba7-92f9-53e40b4b02f9","isLeader":true,"memberAssignment":{"order-events":[0]},"groupProtocol":"RoundRobinAssigner","duration":23878}
product-service-1  | Attempt 1 to start Kafka client failed, retrying in 1000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 2 to start Kafka client failed, retrying in 2000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 3 to start Kafka client failed, retrying in 4000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 4 to start Kafka client failed, retrying in 8000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 5 to start Kafka client failed, retrying in 16000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 6 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 7 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 8 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Failed to start Kafka consumer after retries { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Error starting Kafka consumer: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
product-service-1  |     at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
product-service-1  |     at startKafkaConsumer (/app/index.js:498:24)
product-service-1  |     at runNextTicks (node:internal/process/task_queues:60:5)
product-service-1  |     at process.processTimers (node:internal/timers:509:9)
product-service-1  |     at async start (/app/index.js:538:5) {
product-service-1  |   retriable: false,
product-service-1  |   helpUrl: undefined,
product-service-1  |   [cause]: undefined
product-service-1  | }
product-service-1  | Startup error: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
product-service-1  |     at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
product-service-1  |     at startKafkaConsumer (/app/index.js:498:24)
product-service-1  |     at runNextTicks (node:internal/process/task_queues:60:5)
product-service-1  |     at process.processTimers (node:internal/timers:509:9)
product-service-1  |     at async start (/app/index.js:538:5) {
product-service-1  |   retriable: false,
product-service-1  |   helpUrl: undefined,
product-service-1  |   [cause]: undefined
product-service-1  | }
product-service-1  | 
product-service-1  | > product-service@1.0.0 start
product-service-1  | > node index.js
product-service-1  | 
product-service-1  | [dotenv@17.2.3] injecting env (0) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops
product-service-1  | {"level":"WARN","timestamp":"2026-02-25T18:05:41.382Z","logger":"kafkajs","message":"KafkaJS v2.0.0 switched default partitioner. To retain the same partitioning behavior as in previous versions, create the producer with the option \"createPartitioner: Partitioners.LegacyPartitioner\". See the migration guide at https://kafka.js.org/docs/migration-guide-v2.0.0#producer-new-default-partitioner for details. Silence this warning by setting the environment variable \"KAFKAJS_NO_PARTITIONER_WARNING=1\""}
product-service-1  | Product Service running on port 3002
product-service-1  | Executing (default): SELECT 1+1 AS result
product-service-1  | Database connected successfully
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'Products'
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'Products' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'Products' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "name" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "name" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "name" TYPE VARCHAR(255);
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "stock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "stock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "stock" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "reservedStock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "reservedStock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "reservedStock" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "version" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "version" SET DEFAULT 1;ALTER TABLE "Products" ALTER COLUMN "version" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'Products' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'StockReservations'
product-service-1  | Executing (default): SELECT t.typname enum_name, array_agg(e.enumlabel ORDER BY enumsortorder) enum_value FROM pg_type t JOIN pg_enum e ON t.oid = e.enumtypid JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace WHERE n.nspname = 'public' AND t.typname='enum_StockReservations_status' GROUP BY 1
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'StockReservations' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'StockReservations' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "orderId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "orderId" DROP DEFAULT;ALTER TABLE "StockReservations"  ADD UNIQUE ("orderId");ALTER TABLE "StockReservations" ALTER COLUMN "orderId" TYPE INTEGER  ;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "productId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "productId" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "productId" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "quantity" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "status" DROP NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "status" SET DEFAULT 'RESERVED';DO 'BEGIN CREATE TYPE "public"."enum_StockReservations_status" AS ENUM(''RESERVED'', ''CONFIRMED'', ''RELEASED''); EXCEPTION WHEN duplicate_object THEN null; END';ALTER TABLE "StockReservations" ALTER COLUMN "status" TYPE "public"."enum_StockReservations_status" USING ("status"::"public"."enum_StockReservations_status");
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" DROP CONSTRAINT "StockReservations_ProductId_fkey"
product-service-1  | Executing (default): ALTER TABLE "StockReservations"  ADD FOREIGN KEY ("ProductId") REFERENCES "Products" ("id") ON DELETE SET NULL ON UPDATE CASCADE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'StockReservations' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'ProcessedEvents'
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'ProcessedEvents' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'ProcessedEvents' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" TYPE VARCHAR(255);
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'ProcessedEvents' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Database synced
product-service-1  | Kafka producer connected for product-service
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T18:05:41.588Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T18:06:10.126Z","logger":"kafkajs","message":"[ConsumerGroup] Consumer has joined the group","groupId":"product-group","memberId":"kafkajs-e4d24514-11a9-4842-bd9b-550095e7b02f","leaderId":"kafkajs-e4d24514-11a9-4842-bd9b-550095e7b02f","isLeader":true,"memberAssignment":{"order-events":[0]},"groupProtocol":"RoundRobinAssigner","duration":28536}
product-service-1  | Attempt 1 to start Kafka client failed, retrying in 1000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 2 to start Kafka client failed, retrying in 2000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 3 to start Kafka client failed, retrying in 4000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 4 to start Kafka client failed, retrying in 8000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 5 to start Kafka client failed, retrying in 16000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 6 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | npm error path /app
product-service-1  | npm error command failed
product-service-1  | npm error signal SIGTERM
product-service-1  | npm error command sh -c node index.js
product-service-1  | npm error A complete log of this run can be found in: /home/nodejs/.npm/_logs/2026-02-25T18_05_40_828Z-debug-0.log
product-service-1  | 
product-service-1  | > product-service@1.0.0 start
product-service-1  | > node index.js
product-service-1  | 
product-service-1  | [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com
product-service-1  | {"level":"WARN","timestamp":"2026-02-25T18:06:46.701Z","logger":"kafkajs","message":"KafkaJS v2.0.0 switched default partitioner. To retain the same partitioning behavior as in previous versions, create the producer with the option \"createPartitioner: Partitioners.LegacyPartitioner\". See the migration guide at https://kafka.js.org/docs/migration-guide-v2.0.0#producer-new-default-partitioner for details. Silence this warning by setting the environment variable \"KAFKAJS_NO_PARTITIONER_WARNING=1\""}
product-service-1  | Product Service running on port 3002
product-service-1  | Executing (default): SELECT 1+1 AS result
product-service-1  | Database connected successfully
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'Products'
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'Products' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'Products' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "name" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "name" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "name" TYPE VARCHAR(255);
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "stock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "stock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "stock" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "reservedStock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "reservedStock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "reservedStock" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "version" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "version" SET DEFAULT 1;ALTER TABLE "Products" ALTER COLUMN "version" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'Products' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'StockReservations'
product-service-1  | Executing (default): SELECT t.typname enum_name, array_agg(e.enumlabel ORDER BY enumsortorder) enum_value FROM pg_type t JOIN pg_enum e ON t.oid = e.enumtypid JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace WHERE n.nspname = 'public' AND t.typname='enum_StockReservations_status' GROUP BY 1
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'StockReservations' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'StockReservations' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "orderId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "orderId" DROP DEFAULT;ALTER TABLE "StockReservations"  ADD UNIQUE ("orderId");ALTER TABLE "StockReservations" ALTER COLUMN "orderId" TYPE INTEGER  ;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "productId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "productId" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "productId" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "quantity" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "status" DROP NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "status" SET DEFAULT 'RESERVED';DO 'BEGIN CREATE TYPE "public"."enum_StockReservations_status" AS ENUM(''RESERVED'', ''CONFIRMED'', ''RELEASED''); EXCEPTION WHEN duplicate_object THEN null; END';ALTER TABLE "StockReservations" ALTER COLUMN "status" TYPE "public"."enum_StockReservations_status" USING ("status"::"public"."enum_StockReservations_status");
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" DROP CONSTRAINT "StockReservations_ProductId_fkey"
product-service-1  | Executing (default): ALTER TABLE "StockReservations"  ADD FOREIGN KEY ("ProductId") REFERENCES "Products" ("id") ON DELETE SET NULL ON UPDATE CASCADE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'StockReservations' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'ProcessedEvents'
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'ProcessedEvents' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'ProcessedEvents' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" TYPE VARCHAR(255);
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'ProcessedEvents' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Database synced
product-service-1  | Kafka producer connected for product-service
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T18:06:46.839Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T18:07:10.678Z","logger":"kafkajs","message":"[ConsumerGroup] Consumer has joined the group","groupId":"product-group","memberId":"kafkajs-697bb4ab-548f-4a42-b978-981215d39baf","leaderId":"kafkajs-697bb4ab-548f-4a42-b978-981215d39baf","isLeader":true,"memberAssignment":{"order-events":[0]},"groupProtocol":"RoundRobinAssigner","duration":23838}
product-service-1  | Attempt 1 to start Kafka client failed, retrying in 1000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 2 to start Kafka client failed, retrying in 2000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 3 to start Kafka client failed, retrying in 4000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 4 to start Kafka client failed, retrying in 8000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 5 to start Kafka client failed, retrying in 16000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 6 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 7 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | npm error path /app
product-service-1  | npm error command failed
product-service-1  | npm error signal SIGTERM
product-service-1  | npm error command sh -c node index.js
product-service-1  | npm error A complete log of this run can be found in: /home/nodejs/.npm/_logs/2026-02-25T18_06_46_222Z-debug-0.log
product-service-1  | 
product-service-1  | > product-service@1.0.0 start
product-service-1  | > node index.js
product-service-1  | 
product-service-1  | [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit
product-service-1  | {"level":"WARN","timestamp":"2026-02-25T18:08:18.236Z","logger":"kafkajs","message":"KafkaJS v2.0.0 switched default partitioner. To retain the same partitioning behavior as in previous versions, create the producer with the option \"createPartitioner: Partitioners.LegacyPartitioner\". See the migration guide at https://kafka.js.org/docs/migration-guide-v2.0.0#producer-new-default-partitioner for details. Silence this warning by setting the environment variable \"KAFKAJS_NO_PARTITIONER_WARNING=1\""}
product-service-1  | Product Service running on port 3002
product-service-1  | Executing (default): SELECT 1+1 AS result
product-service-1  | Database connected successfully
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'Products'
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'Products' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'Products' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "name" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "name" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "name" TYPE VARCHAR(255);
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "stock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "stock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "stock" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "reservedStock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "reservedStock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "reservedStock" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "version" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "version" SET DEFAULT 1;ALTER TABLE "Products" ALTER COLUMN "version" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'Products' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'StockReservations'
product-service-1  | Executing (default): SELECT t.typname enum_name, array_agg(e.enumlabel ORDER BY enumsortorder) enum_value FROM pg_type t JOIN pg_enum e ON t.oid = e.enumtypid JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace WHERE n.nspname = 'public' AND t.typname='enum_StockReservations_status' GROUP BY 1
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'StockReservations' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'StockReservations' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "orderId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "orderId" DROP DEFAULT;ALTER TABLE "StockReservations"  ADD UNIQUE ("orderId");ALTER TABLE "StockReservations" ALTER COLUMN "orderId" TYPE INTEGER  ;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "productId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "productId" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "productId" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "quantity" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "status" DROP NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "status" SET DEFAULT 'RESERVED';DO 'BEGIN CREATE TYPE "public"."enum_StockReservations_status" AS ENUM(''RESERVED'', ''CONFIRMED'', ''RELEASED''); EXCEPTION WHEN duplicate_object THEN null; END';ALTER TABLE "StockReservations" ALTER COLUMN "status" TYPE "public"."enum_StockReservations_status" USING ("status"::"public"."enum_StockReservations_status");
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" DROP CONSTRAINT "StockReservations_ProductId_fkey"
product-service-1  | Executing (default): ALTER TABLE "StockReservations"  ADD FOREIGN KEY ("ProductId") REFERENCES "Products" ("id") ON DELETE SET NULL ON UPDATE CASCADE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'StockReservations' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'ProcessedEvents'
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'ProcessedEvents' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'ProcessedEvents' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" TYPE VARCHAR(255);
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'ProcessedEvents' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Database synced
product-service-1  | Kafka producer connected for product-service
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T18:08:18.374Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T18:08:46.151Z","logger":"kafkajs","message":"[ConsumerGroup] Consumer has joined the group","groupId":"product-group","memberId":"kafkajs-905d5d05-0bd1-4ac3-93e5-0f8ac4d7697b","leaderId":"kafkajs-905d5d05-0bd1-4ac3-93e5-0f8ac4d7697b","isLeader":true,"memberAssignment":{"order-events":[0]},"groupProtocol":"RoundRobinAssigner","duration":27776}
product-service-1  | Attempt 1 to start Kafka client failed, retrying in 1000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 2 to start Kafka client failed, retrying in 2000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 3 to start Kafka client failed, retrying in 4000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 4 to start Kafka client failed, retrying in 8000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 5 to start Kafka client failed, retrying in 16000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 6 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 7 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | npm error path /app
product-service-1  | npm error command failed
product-service-1  | npm error signal SIGTERM
product-service-1  | npm error command sh -c node index.js
product-service-1  | npm error A complete log of this run can be found in: /home/nodejs/.npm/_logs/2026-02-25T18_08_17_783Z-debug-0.log
product-service-1  | 
product-service-1  | > product-service@1.0.0 start
product-service-1  | > node index.js
product-service-1  | 
product-service-1  | [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }
product-service-1  | {"level":"WARN","timestamp":"2026-02-25T18:09:51.614Z","logger":"kafkajs","message":"KafkaJS v2.0.0 switched default partitioner. To retain the same partitioning behavior as in previous versions, create the producer with the option \"createPartitioner: Partitioners.LegacyPartitioner\". See the migration guide at https://kafka.js.org/docs/migration-guide-v2.0.0#producer-new-default-partitioner for details. Silence this warning by setting the environment variable \"KAFKAJS_NO_PARTITIONER_WARNING=1\""}
product-service-1  | Product Service running on port 3002
product-service-1  | Executing (default): SELECT 1+1 AS result
product-service-1  | Database connected successfully
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'Products'
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'Products' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'Products' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "name" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "name" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "name" TYPE VARCHAR(255);
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "stock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "stock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "stock" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "reservedStock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "reservedStock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "reservedStock" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "version" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "version" SET DEFAULT 1;ALTER TABLE "Products" ALTER COLUMN "version" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'Products' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'StockReservations'
product-service-1  | Executing (default): SELECT t.typname enum_name, array_agg(e.enumlabel ORDER BY enumsortorder) enum_value FROM pg_type t JOIN pg_enum e ON t.oid = e.enumtypid JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace WHERE n.nspname = 'public' AND t.typname='enum_StockReservations_status' GROUP BY 1
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'StockReservations' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'StockReservations' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "orderId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "orderId" DROP DEFAULT;ALTER TABLE "StockReservations"  ADD UNIQUE ("orderId");ALTER TABLE "StockReservations" ALTER COLUMN "orderId" TYPE INTEGER  ;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "productId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "productId" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "productId" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "quantity" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "status" DROP NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "status" SET DEFAULT 'RESERVED';DO 'BEGIN CREATE TYPE "public"."enum_StockReservations_status" AS ENUM(''RESERVED'', ''CONFIRMED'', ''RELEASED''); EXCEPTION WHEN duplicate_object THEN null; END';ALTER TABLE "StockReservations" ALTER COLUMN "status" TYPE "public"."enum_StockReservations_status" USING ("status"::"public"."enum_StockReservations_status");
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" DROP CONSTRAINT "StockReservations_ProductId_fkey"
product-service-1  | Executing (default): ALTER TABLE "StockReservations"  ADD FOREIGN KEY ("ProductId") REFERENCES "Products" ("id") ON DELETE SET NULL ON UPDATE CASCADE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'StockReservations' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'ProcessedEvents'
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'ProcessedEvents' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'ProcessedEvents' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" TYPE VARCHAR(255);
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'ProcessedEvents' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Database synced
product-service-1  | Kafka producer connected for product-service
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T18:09:51.749Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T18:10:16.818Z","logger":"kafkajs","message":"[ConsumerGroup] Consumer has joined the group","groupId":"product-group","memberId":"kafkajs-96b82ff8-18b2-4534-9ad8-6f0dd498e0aa","leaderId":"kafkajs-96b82ff8-18b2-4534-9ad8-6f0dd498e0aa","isLeader":true,"memberAssignment":{"order-events":[0]},"groupProtocol":"RoundRobinAssigner","duration":25069}
product-service-1  | Attempt 1 to start Kafka client failed, retrying in 1000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 2 to start Kafka client failed, retrying in 2000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 3 to start Kafka client failed, retrying in 4000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 4 to start Kafka client failed, retrying in 8000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 5 to start Kafka client failed, retrying in 16000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 6 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 7 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | npm error path /app
product-service-1  | npm error command failed
product-service-1  | npm error signal SIGTERM
product-service-1  | npm error command sh -c node index.js
product-service-1  | npm error A complete log of this run can be found in: /home/nodejs/.npm/_logs/2026-02-25T18_09_51_057Z-debug-0.log
product-service-1  | 
product-service-1  | > product-service@1.0.0 start
product-service-1  | > node index.js
product-service-1  | 
product-service-1  | [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com
product-service-1  | {"level":"WARN","timestamp":"2026-02-25T18:11:36.421Z","logger":"kafkajs","message":"KafkaJS v2.0.0 switched default partitioner. To retain the same partitioning behavior as in previous versions, create the producer with the option \"createPartitioner: Partitioners.LegacyPartitioner\". See the migration guide at https://kafka.js.org/docs/migration-guide-v2.0.0#producer-new-default-partitioner for details. Silence this warning by setting the environment variable \"KAFKAJS_NO_PARTITIONER_WARNING=1\""}
product-service-1  | Product Service running on port 3002
product-service-1  | Executing (default): SELECT 1+1 AS result
product-service-1  | Database connected successfully
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'Products'
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'Products' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'Products' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "name" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "name" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "name" TYPE VARCHAR(255);
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "stock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "stock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "stock" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "reservedStock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "reservedStock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "reservedStock" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "version" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "version" SET DEFAULT 1;ALTER TABLE "Products" ALTER COLUMN "version" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'Products' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'StockReservations'
product-service-1  | Executing (default): SELECT t.typname enum_name, array_agg(e.enumlabel ORDER BY enumsortorder) enum_value FROM pg_type t JOIN pg_enum e ON t.oid = e.enumtypid JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace WHERE n.nspname = 'public' AND t.typname='enum_StockReservations_status' GROUP BY 1
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'StockReservations' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'StockReservations' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "orderId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "orderId" DROP DEFAULT;ALTER TABLE "StockReservations"  ADD UNIQUE ("orderId");ALTER TABLE "StockReservations" ALTER COLUMN "orderId" TYPE INTEGER  ;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "productId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "productId" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "productId" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "quantity" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "status" DROP NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "status" SET DEFAULT 'RESERVED';DO 'BEGIN CREATE TYPE "public"."enum_StockReservations_status" AS ENUM(''RESERVED'', ''CONFIRMED'', ''RELEASED''); EXCEPTION WHEN duplicate_object THEN null; END';ALTER TABLE "StockReservations" ALTER COLUMN "status" TYPE "public"."enum_StockReservations_status" USING ("status"::"public"."enum_StockReservations_status");
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" DROP CONSTRAINT "StockReservations_ProductId_fkey"
product-service-1  | Executing (default): ALTER TABLE "StockReservations"  ADD FOREIGN KEY ("ProductId") REFERENCES "Products" ("id") ON DELETE SET NULL ON UPDATE CASCADE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'StockReservations' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'ProcessedEvents'
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'ProcessedEvents' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'ProcessedEvents' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" TYPE VARCHAR(255);
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'ProcessedEvents' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Database synced
product-service-1  | Kafka producer connected for product-service
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T18:11:36.615Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
product-service-1  | Executing (default): SELECT "id", "name", "stock", "reservedStock", "version", "createdAt", "updatedAt" FROM "Products" AS "Product";
product-service-1  | Executing (default): SELECT "id", "name", "stock", "reservedStock", "version", "createdAt", "updatedAt" FROM "Products" AS "Product";
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T18:12:02.465Z","logger":"kafkajs","message":"[ConsumerGroup] Consumer has joined the group","groupId":"product-group","memberId":"kafkajs-a1f2b7be-688e-46ed-a735-1bd05840dacb","leaderId":"kafkajs-a1f2b7be-688e-46ed-a735-1bd05840dacb","isLeader":true,"memberAssignment":{"order-events":[0]},"groupProtocol":"RoundRobinAssigner","duration":25849}
product-service-1  | Attempt 1 to start Kafka client failed, retrying in 1000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 2 to start Kafka client failed, retrying in 2000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 3 to start Kafka client failed, retrying in 4000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 4 to start Kafka client failed, retrying in 8000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 5 to start Kafka client failed, retrying in 16000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 6 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 7 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 8 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Failed to start Kafka consumer after retries { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Error starting Kafka consumer: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
product-service-1  |     at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
product-service-1  |     at startKafkaConsumer (/app/index.js:498:24)
product-service-1  |     at runNextTicks (node:internal/process/task_queues:60:5)
product-service-1  |     at process.processTimers (node:internal/timers:509:9)
product-service-1  |     at async start (/app/index.js:538:5) {
product-service-1  |   retriable: false,
product-service-1  |   helpUrl: undefined,
product-service-1  |   [cause]: undefined
product-service-1  | }
product-service-1  | Startup error: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
product-service-1  |     at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
product-service-1  |     at startKafkaConsumer (/app/index.js:498:24)
product-service-1  |     at runNextTicks (node:internal/process/task_queues:60:5)
product-service-1  |     at process.processTimers (node:internal/timers:509:9)
product-service-1  |     at async start (/app/index.js:538:5) {
product-service-1  |   retriable: false,
product-service-1  |   helpUrl: undefined,
product-service-1  |   [cause]: undefined
product-service-1  | }
product-service-1  | 
product-service-1  | > product-service@1.0.0 start
product-service-1  | > node index.js
product-service-1  | 
product-service-1  | [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }
product-service-1  | {"level":"WARN","timestamp":"2026-02-25T18:13:34.412Z","logger":"kafkajs","message":"KafkaJS v2.0.0 switched default partitioner. To retain the same partitioning behavior as in previous versions, create the producer with the option \"createPartitioner: Partitioners.LegacyPartitioner\". See the migration guide at https://kafka.js.org/docs/migration-guide-v2.0.0#producer-new-default-partitioner for details. Silence this warning by setting the environment variable \"KAFKAJS_NO_PARTITIONER_WARNING=1\""}
product-service-1  | Product Service running on port 3002
product-service-1  | Executing (default): SELECT 1+1 AS result
product-service-1  | Database connected successfully
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'Products'
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'Products' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'Products' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "name" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "name" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "name" TYPE VARCHAR(255);
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "stock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "stock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "stock" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "reservedStock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "reservedStock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "reservedStock" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "version" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "version" SET DEFAULT 1;ALTER TABLE "Products" ALTER COLUMN "version" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'Products' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'StockReservations'
product-service-1  | Executing (default): SELECT t.typname enum_name, array_agg(e.enumlabel ORDER BY enumsortorder) enum_value FROM pg_type t JOIN pg_enum e ON t.oid = e.enumtypid JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace WHERE n.nspname = 'public' AND t.typname='enum_StockReservations_status' GROUP BY 1
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'StockReservations' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'StockReservations' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "orderId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "orderId" DROP DEFAULT;ALTER TABLE "StockReservations"  ADD UNIQUE ("orderId");ALTER TABLE "StockReservations" ALTER COLUMN "orderId" TYPE INTEGER  ;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "productId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "productId" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "productId" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "quantity" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "status" DROP NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "status" SET DEFAULT 'RESERVED';DO 'BEGIN CREATE TYPE "public"."enum_StockReservations_status" AS ENUM(''RESERVED'', ''CONFIRMED'', ''RELEASED''); EXCEPTION WHEN duplicate_object THEN null; END';ALTER TABLE "StockReservations" ALTER COLUMN "status" TYPE "public"."enum_StockReservations_status" USING ("status"::"public"."enum_StockReservations_status");
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" DROP CONSTRAINT "StockReservations_ProductId_fkey"
product-service-1  | Executing (default): ALTER TABLE "StockReservations"  ADD FOREIGN KEY ("ProductId") REFERENCES "Products" ("id") ON DELETE SET NULL ON UPDATE CASCADE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'StockReservations' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'ProcessedEvents'
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'ProcessedEvents' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'ProcessedEvents' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" TYPE VARCHAR(255);
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'ProcessedEvents' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Database synced
product-service-1  | Kafka producer connected for product-service
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T18:13:34.579Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T18:14:03.174Z","logger":"kafkajs","message":"[ConsumerGroup] Consumer has joined the group","groupId":"product-group","memberId":"kafkajs-64b45706-b50d-4292-9288-2f614c3c330a","leaderId":"kafkajs-64b45706-b50d-4292-9288-2f614c3c330a","isLeader":true,"memberAssignment":{"order-events":[0]},"groupProtocol":"RoundRobinAssigner","duration":28593}
product-service-1  | Attempt 1 to start Kafka client failed, retrying in 1000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 2 to start Kafka client failed, retrying in 2000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 3 to start Kafka client failed, retrying in 4000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 4 to start Kafka client failed, retrying in 8000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 5 to start Kafka client failed, retrying in 16000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 6 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 7 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 8 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Failed to start Kafka consumer after retries { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Error starting Kafka consumer: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
product-service-1  |     at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
product-service-1  |     at startKafkaConsumer (/app/index.js:498:24)
product-service-1  |     at runNextTicks (node:internal/process/task_queues:60:5)
product-service-1  |     at process.processTimers (node:internal/timers:509:9)
product-service-1  |     at async start (/app/index.js:538:5) {
product-service-1  |   retriable: false,
product-service-1  |   helpUrl: undefined,
product-service-1  |   [cause]: undefined
product-service-1  | }
product-service-1  | Startup error: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
product-service-1  |     at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
product-service-1  |     at startKafkaConsumer (/app/index.js:498:24)
product-service-1  |     at runNextTicks (node:internal/process/task_queues:60:5)
product-service-1  |     at process.processTimers (node:internal/timers:509:9)
product-service-1  |     at async start (/app/index.js:538:5) {
product-service-1  |   retriable: false,
product-service-1  |   helpUrl: undefined,
product-service-1  |   [cause]: undefined
product-service-1  | }
product-service-1  | 
product-service-1  | > product-service@1.0.0 start
product-service-1  | > node index.js
product-service-1  | 
product-service-1  | [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }
product-service-1  | {"level":"WARN","timestamp":"2026-02-25T18:15:35.166Z","logger":"kafkajs","message":"KafkaJS v2.0.0 switched default partitioner. To retain the same partitioning behavior as in previous versions, create the producer with the option \"createPartitioner: Partitioners.LegacyPartitioner\". See the migration guide at https://kafka.js.org/docs/migration-guide-v2.0.0#producer-new-default-partitioner for details. Silence this warning by setting the environment variable \"KAFKAJS_NO_PARTITIONER_WARNING=1\""}
product-service-1  | Product Service running on port 3002
product-service-1  | Executing (default): SELECT 1+1 AS result
product-service-1  | Database connected successfully
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'Products'
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'Products' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'Products' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "name" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "name" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "name" TYPE VARCHAR(255);
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "stock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "stock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "stock" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "reservedStock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "reservedStock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "reservedStock" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "version" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "version" SET DEFAULT 1;ALTER TABLE "Products" ALTER COLUMN "version" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'Products' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'StockReservations'
product-service-1  | Executing (default): SELECT t.typname enum_name, array_agg(e.enumlabel ORDER BY enumsortorder) enum_value FROM pg_type t JOIN pg_enum e ON t.oid = e.enumtypid JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace WHERE n.nspname = 'public' AND t.typname='enum_StockReservations_status' GROUP BY 1
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'StockReservations' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'StockReservations' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "orderId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "orderId" DROP DEFAULT;ALTER TABLE "StockReservations"  ADD UNIQUE ("orderId");ALTER TABLE "StockReservations" ALTER COLUMN "orderId" TYPE INTEGER  ;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "productId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "productId" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "productId" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "quantity" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "status" DROP NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "status" SET DEFAULT 'RESERVED';DO 'BEGIN CREATE TYPE "public"."enum_StockReservations_status" AS ENUM(''RESERVED'', ''CONFIRMED'', ''RELEASED''); EXCEPTION WHEN duplicate_object THEN null; END';ALTER TABLE "StockReservations" ALTER COLUMN "status" TYPE "public"."enum_StockReservations_status" USING ("status"::"public"."enum_StockReservations_status");
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" DROP CONSTRAINT "StockReservations_ProductId_fkey"
product-service-1  | Executing (default): ALTER TABLE "StockReservations"  ADD FOREIGN KEY ("ProductId") REFERENCES "Products" ("id") ON DELETE SET NULL ON UPDATE CASCADE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'StockReservations' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'ProcessedEvents'
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'ProcessedEvents' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'ProcessedEvents' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" TYPE VARCHAR(255);
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'ProcessedEvents' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Database synced
product-service-1  | Kafka producer connected for product-service
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T18:15:35.359Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T18:16:04.058Z","logger":"kafkajs","message":"[ConsumerGroup] Consumer has joined the group","groupId":"product-group","memberId":"kafkajs-2b1c8802-b7b2-43d6-bb38-458fd1c77a08","leaderId":"kafkajs-2b1c8802-b7b2-43d6-bb38-458fd1c77a08","isLeader":true,"memberAssignment":{"order-events":[0]},"groupProtocol":"RoundRobinAssigner","duration":28698}
product-service-1  | Attempt 1 to start Kafka client failed, retrying in 1000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 2 to start Kafka client failed, retrying in 2000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 3 to start Kafka client failed, retrying in 4000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 4 to start Kafka client failed, retrying in 8000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 5 to start Kafka client failed, retrying in 16000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Executing (default): SELECT "id", "name", "stock", "reservedStock", "version", "createdAt", "updatedAt" FROM "Products" AS "Product";
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 6 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 7 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 8 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Failed to start Kafka consumer after retries { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Error starting Kafka consumer: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
product-service-1  |     at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
product-service-1  |     at startKafkaConsumer (/app/index.js:498:24)
product-service-1  |     at async start (/app/index.js:538:5) {
product-service-1  |   retriable: false,
product-service-1  |   helpUrl: undefined,
product-service-1  |   [cause]: undefined
product-service-1  | }
product-service-1  | Startup error: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
product-service-1  |     at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
product-service-1  |     at startKafkaConsumer (/app/index.js:498:24)
product-service-1  |     at async start (/app/index.js:538:5) {
product-service-1  |   retriable: false,
product-service-1  |   helpUrl: undefined,
product-service-1  |   [cause]: undefined
product-service-1  | }
product-service-1  | 
product-service-1  | > product-service@1.0.0 start
product-service-1  | > node index.js
product-service-1  | 
product-service-1  | [dotenv@17.2.3] injecting env (0) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops
product-service-1  | {"level":"WARN","timestamp":"2026-02-25T18:17:35.968Z","logger":"kafkajs","message":"KafkaJS v2.0.0 switched default partitioner. To retain the same partitioning behavior as in previous versions, create the producer with the option \"createPartitioner: Partitioners.LegacyPartitioner\". See the migration guide at https://kafka.js.org/docs/migration-guide-v2.0.0#producer-new-default-partitioner for details. Silence this warning by setting the environment variable \"KAFKAJS_NO_PARTITIONER_WARNING=1\""}
product-service-1  | Product Service running on port 3002
product-service-1  | Executing (default): SELECT 1+1 AS result
product-service-1  | Database connected successfully
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'Products'
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'Products' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'Products' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "name" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "name" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "name" TYPE VARCHAR(255);
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "stock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "stock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "stock" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "reservedStock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "reservedStock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "reservedStock" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "version" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "version" SET DEFAULT 1;ALTER TABLE "Products" ALTER COLUMN "version" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'Products' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'StockReservations'
product-service-1  | Executing (default): SELECT t.typname enum_name, array_agg(e.enumlabel ORDER BY enumsortorder) enum_value FROM pg_type t JOIN pg_enum e ON t.oid = e.enumtypid JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace WHERE n.nspname = 'public' AND t.typname='enum_StockReservations_status' GROUP BY 1
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'StockReservations' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'StockReservations' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "orderId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "orderId" DROP DEFAULT;ALTER TABLE "StockReservations"  ADD UNIQUE ("orderId");ALTER TABLE "StockReservations" ALTER COLUMN "orderId" TYPE INTEGER  ;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "productId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "productId" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "productId" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "quantity" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "status" DROP NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "status" SET DEFAULT 'RESERVED';DO 'BEGIN CREATE TYPE "public"."enum_StockReservations_status" AS ENUM(''RESERVED'', ''CONFIRMED'', ''RELEASED''); EXCEPTION WHEN duplicate_object THEN null; END';ALTER TABLE "StockReservations" ALTER COLUMN "status" TYPE "public"."enum_StockReservations_status" USING ("status"::"public"."enum_StockReservations_status");
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" DROP CONSTRAINT "StockReservations_ProductId_fkey"
product-service-1  | Executing (default): ALTER TABLE "StockReservations"  ADD FOREIGN KEY ("ProductId") REFERENCES "Products" ("id") ON DELETE SET NULL ON UPDATE CASCADE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'StockReservations' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'ProcessedEvents'
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'ProcessedEvents' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'ProcessedEvents' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" TYPE VARCHAR(255);
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'ProcessedEvents' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Database synced
product-service-1  | Kafka producer connected for product-service
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T18:17:36.094Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T18:18:04.815Z","logger":"kafkajs","message":"[ConsumerGroup] Consumer has joined the group","groupId":"product-group","memberId":"kafkajs-d5a9a97a-6fe6-48ba-8025-29a92514a130","leaderId":"kafkajs-d5a9a97a-6fe6-48ba-8025-29a92514a130","isLeader":true,"memberAssignment":{"order-events":[0]},"groupProtocol":"RoundRobinAssigner","duration":28720}
product-service-1  | Attempt 1 to start Kafka client failed, retrying in 1000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 2 to start Kafka client failed, retrying in 2000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 3 to start Kafka client failed, retrying in 4000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 4 to start Kafka client failed, retrying in 8000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 5 to start Kafka client failed, retrying in 16000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 6 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 7 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 8 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Failed to start Kafka consumer after retries { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Error starting Kafka consumer: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
product-service-1  |     at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
product-service-1  |     at startKafkaConsumer (/app/index.js:498:24)
product-service-1  |     at runNextTicks (node:internal/process/task_queues:60:5)
product-service-1  |     at process.processTimers (node:internal/timers:509:9)
product-service-1  |     at async start (/app/index.js:538:5) {
product-service-1  |   retriable: false,
product-service-1  |   helpUrl: undefined,
product-service-1  |   [cause]: undefined
product-service-1  | }
product-service-1  | Startup error: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
product-service-1  |     at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
product-service-1  |     at startKafkaConsumer (/app/index.js:498:24)
product-service-1  |     at runNextTicks (node:internal/process/task_queues:60:5)
product-service-1  |     at process.processTimers (node:internal/timers:509:9)
product-service-1  |     at async start (/app/index.js:538:5) {
product-service-1  |   retriable: false,
product-service-1  |   helpUrl: undefined,
product-service-1  |   [cause]: undefined
product-service-1  | }
product-service-1  | 
product-service-1  | > product-service@1.0.0 start
product-service-1  | > node index.js
product-service-1  | 
product-service-1  | [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit
product-service-1  | {"level":"WARN","timestamp":"2026-02-25T18:19:36.754Z","logger":"kafkajs","message":"KafkaJS v2.0.0 switched default partitioner. To retain the same partitioning behavior as in previous versions, create the producer with the option \"createPartitioner: Partitioners.LegacyPartitioner\". See the migration guide at https://kafka.js.org/docs/migration-guide-v2.0.0#producer-new-default-partitioner for details. Silence this warning by setting the environment variable \"KAFKAJS_NO_PARTITIONER_WARNING=1\""}
product-service-1  | Product Service running on port 3002
product-service-1  | Executing (default): SELECT 1+1 AS result
product-service-1  | Database connected successfully
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'Products'
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'Products' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'Products' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "name" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "name" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "name" TYPE VARCHAR(255);
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "stock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "stock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "stock" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "reservedStock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "reservedStock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "reservedStock" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "version" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "version" SET DEFAULT 1;ALTER TABLE "Products" ALTER COLUMN "version" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'Products' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'StockReservations'
product-service-1  | Executing (default): SELECT t.typname enum_name, array_agg(e.enumlabel ORDER BY enumsortorder) enum_value FROM pg_type t JOIN pg_enum e ON t.oid = e.enumtypid JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace WHERE n.nspname = 'public' AND t.typname='enum_StockReservations_status' GROUP BY 1
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'StockReservations' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'StockReservations' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "orderId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "orderId" DROP DEFAULT;ALTER TABLE "StockReservations"  ADD UNIQUE ("orderId");ALTER TABLE "StockReservations" ALTER COLUMN "orderId" TYPE INTEGER  ;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "productId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "productId" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "productId" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "quantity" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "status" DROP NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "status" SET DEFAULT 'RESERVED';DO 'BEGIN CREATE TYPE "public"."enum_StockReservations_status" AS ENUM(''RESERVED'', ''CONFIRMED'', ''RELEASED''); EXCEPTION WHEN duplicate_object THEN null; END';ALTER TABLE "StockReservations" ALTER COLUMN "status" TYPE "public"."enum_StockReservations_status" USING ("status"::"public"."enum_StockReservations_status");
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" DROP CONSTRAINT "StockReservations_ProductId_fkey"
product-service-1  | Executing (default): ALTER TABLE "StockReservations"  ADD FOREIGN KEY ("ProductId") REFERENCES "Products" ("id") ON DELETE SET NULL ON UPDATE CASCADE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'StockReservations' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'ProcessedEvents'
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'ProcessedEvents' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'ProcessedEvents' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" TYPE VARCHAR(255);
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'ProcessedEvents' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Database synced
product-service-1  | Kafka producer connected for product-service
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T18:19:36.899Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
product-service-1  | Executing (default): SELECT "id", "name", "stock", "reservedStock", "version", "createdAt", "updatedAt" FROM "Products" AS "Product";
product-service-1  | Executing (default): SELECT "id", "name", "stock", "reservedStock", "version", "createdAt", "updatedAt" FROM "Products" AS "Product";
product-service-1  | Executing (default): SELECT "id", "name", "stock", "reservedStock", "version", "createdAt", "updatedAt" FROM "Products" AS "Product";
product-service-1  | Executing (default): SELECT "id", "name", "stock", "reservedStock", "version", "createdAt", "updatedAt" FROM "Products" AS "Product";
product-service-1  | Executing (default): SELECT "id", "name", "stock", "reservedStock", "version", "createdAt", "updatedAt" FROM "Products" AS "Product";
product-service-1  | Executing (default): SELECT "id", "name", "stock", "reservedStock", "version", "createdAt", "updatedAt" FROM "Products" AS "Product";
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T18:20:05.652Z","logger":"kafkajs","message":"[ConsumerGroup] Consumer has joined the group","groupId":"product-group","memberId":"kafkajs-3cdd25f9-1237-440f-93a1-ebfed15f00a6","leaderId":"kafkajs-3cdd25f9-1237-440f-93a1-ebfed15f00a6","isLeader":true,"memberAssignment":{"order-events":[0]},"groupProtocol":"RoundRobinAssigner","duration":28752}
product-service-1  | Attempt 1 to start Kafka client failed, retrying in 1000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 2 to start Kafka client failed, retrying in 2000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 3 to start Kafka client failed, retrying in 4000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 4 to start Kafka client failed, retrying in 8000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 5 to start Kafka client failed, retrying in 16000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 6 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 7 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 8 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Failed to start Kafka consumer after retries { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Error starting Kafka consumer: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
product-service-1  |     at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
product-service-1  |     at startKafkaConsumer (/app/index.js:498:24)
product-service-1  |     at runNextTicks (node:internal/process/task_queues:60:5)
product-service-1  |     at process.processTimers (node:internal/timers:509:9)
product-service-1  |     at async start (/app/index.js:538:5) {
product-service-1  |   retriable: false,
product-service-1  |   helpUrl: undefined,
product-service-1  |   [cause]: undefined
product-service-1  | }
product-service-1  | Startup error: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
product-service-1  |     at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
product-service-1  |     at startKafkaConsumer (/app/index.js:498:24)
product-service-1  |     at runNextTicks (node:internal/process/task_queues:60:5)
product-service-1  |     at process.processTimers (node:internal/timers:509:9)
product-service-1  |     at async start (/app/index.js:538:5) {
product-service-1  |   retriable: false,
product-service-1  |   helpUrl: undefined,
product-service-1  |   [cause]: undefined
product-service-1  | }
product-service-1  | 
product-service-1  | > product-service@1.0.0 start
product-service-1  | > node index.js
product-service-1  | 
product-service-1  | [dotenv@17.2.3] injecting env (0) from .env -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops
product-service-1  | {"level":"WARN","timestamp":"2026-02-25T18:21:37.454Z","logger":"kafkajs","message":"KafkaJS v2.0.0 switched default partitioner. To retain the same partitioning behavior as in previous versions, create the producer with the option \"createPartitioner: Partitioners.LegacyPartitioner\". See the migration guide at https://kafka.js.org/docs/migration-guide-v2.0.0#producer-new-default-partitioner for details. Silence this warning by setting the environment variable \"KAFKAJS_NO_PARTITIONER_WARNING=1\""}
product-service-1  | Product Service running on port 3002
product-service-1  | Executing (default): SELECT 1+1 AS result
product-service-1  | Database connected successfully
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'Products'
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'Products' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'Products' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "name" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "name" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "name" TYPE VARCHAR(255);
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "stock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "stock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "stock" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "reservedStock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "reservedStock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "reservedStock" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "version" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "version" SET DEFAULT 1;ALTER TABLE "Products" ALTER COLUMN "version" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'Products' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'StockReservations'
product-service-1  | Executing (default): SELECT t.typname enum_name, array_agg(e.enumlabel ORDER BY enumsortorder) enum_value FROM pg_type t JOIN pg_enum e ON t.oid = e.enumtypid JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace WHERE n.nspname = 'public' AND t.typname='enum_StockReservations_status' GROUP BY 1
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'StockReservations' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'StockReservations' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "orderId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "orderId" DROP DEFAULT;ALTER TABLE "StockReservations"  ADD UNIQUE ("orderId");ALTER TABLE "StockReservations" ALTER COLUMN "orderId" TYPE INTEGER  ;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "productId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "productId" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "productId" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "quantity" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "status" DROP NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "status" SET DEFAULT 'RESERVED';DO 'BEGIN CREATE TYPE "public"."enum_StockReservations_status" AS ENUM(''RESERVED'', ''CONFIRMED'', ''RELEASED''); EXCEPTION WHEN duplicate_object THEN null; END';ALTER TABLE "StockReservations" ALTER COLUMN "status" TYPE "public"."enum_StockReservations_status" USING ("status"::"public"."enum_StockReservations_status");
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" DROP CONSTRAINT "StockReservations_ProductId_fkey"
product-service-1  | Executing (default): ALTER TABLE "StockReservations"  ADD FOREIGN KEY ("ProductId") REFERENCES "Products" ("id") ON DELETE SET NULL ON UPDATE CASCADE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'StockReservations' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'ProcessedEvents'
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'ProcessedEvents' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'ProcessedEvents' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" TYPE VARCHAR(255);
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'ProcessedEvents' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Database synced
product-service-1  | Kafka producer connected for product-service
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T18:21:37.566Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T18:22:01.907Z","logger":"kafkajs","message":"[ConsumerGroup] Consumer has joined the group","groupId":"product-group","memberId":"kafkajs-b3c0ba22-7d65-4cd4-a00c-27e4ac287bef","leaderId":"kafkajs-b3c0ba22-7d65-4cd4-a00c-27e4ac287bef","isLeader":true,"memberAssignment":{"order-events":[0]},"groupProtocol":"RoundRobinAssigner","duration":24340}
product-service-1  | Attempt 1 to start Kafka client failed, retrying in 1000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 2 to start Kafka client failed, retrying in 2000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 3 to start Kafka client failed, retrying in 4000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 4 to start Kafka client failed, retrying in 8000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 5 to start Kafka client failed, retrying in 16000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 6 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 7 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 8 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Failed to start Kafka consumer after retries { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Error starting Kafka consumer: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
product-service-1  |     at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
product-service-1  |     at startKafkaConsumer (/app/index.js:498:24)
product-service-1  |     at runNextTicks (node:internal/process/task_queues:60:5)
product-service-1  |     at process.processTimers (node:internal/timers:509:9)
product-service-1  |     at async start (/app/index.js:538:5) {
product-service-1  |   retriable: false,
product-service-1  |   helpUrl: undefined,
product-service-1  |   [cause]: undefined
product-service-1  | }
product-service-1  | Startup error: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
product-service-1  |     at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
product-service-1  |     at startKafkaConsumer (/app/index.js:498:24)
product-service-1  |     at runNextTicks (node:internal/process/task_queues:60:5)
product-service-1  |     at process.processTimers (node:internal/timers:509:9)
product-service-1  |     at async start (/app/index.js:538:5) {
product-service-1  |   retriable: false,
product-service-1  |   helpUrl: undefined,
product-service-1  |   [cause]: undefined
product-service-1  | }
product-service-1  | 
product-service-1  | > product-service@1.0.0 start
product-service-1  | > node index.js
product-service-1  | 
product-service-1  | [dotenv@17.2.3] injecting env (0) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`
product-service-1  | {"level":"WARN","timestamp":"2026-02-25T18:23:33.594Z","logger":"kafkajs","message":"KafkaJS v2.0.0 switched default partitioner. To retain the same partitioning behavior as in previous versions, create the producer with the option \"createPartitioner: Partitioners.LegacyPartitioner\". See the migration guide at https://kafka.js.org/docs/migration-guide-v2.0.0#producer-new-default-partitioner for details. Silence this warning by setting the environment variable \"KAFKAJS_NO_PARTITIONER_WARNING=1\""}
product-service-1  | Product Service running on port 3002
product-service-1  | Executing (default): SELECT 1+1 AS result
product-service-1  | Database connected successfully
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'Products'
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'Products' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'Products' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "name" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "name" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "name" TYPE VARCHAR(255);
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "stock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "stock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "stock" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "reservedStock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "reservedStock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "reservedStock" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "version" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "version" SET DEFAULT 1;ALTER TABLE "Products" ALTER COLUMN "version" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'Products' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'StockReservations'
product-service-1  | Executing (default): SELECT t.typname enum_name, array_agg(e.enumlabel ORDER BY enumsortorder) enum_value FROM pg_type t JOIN pg_enum e ON t.oid = e.enumtypid JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace WHERE n.nspname = 'public' AND t.typname='enum_StockReservations_status' GROUP BY 1
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'StockReservations' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'StockReservations' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "orderId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "orderId" DROP DEFAULT;ALTER TABLE "StockReservations"  ADD UNIQUE ("orderId");ALTER TABLE "StockReservations" ALTER COLUMN "orderId" TYPE INTEGER  ;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "productId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "productId" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "productId" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "quantity" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "status" DROP NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "status" SET DEFAULT 'RESERVED';DO 'BEGIN CREATE TYPE "public"."enum_StockReservations_status" AS ENUM(''RESERVED'', ''CONFIRMED'', ''RELEASED''); EXCEPTION WHEN duplicate_object THEN null; END';ALTER TABLE "StockReservations" ALTER COLUMN "status" TYPE "public"."enum_StockReservations_status" USING ("status"::"public"."enum_StockReservations_status");
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" DROP CONSTRAINT "StockReservations_ProductId_fkey"
product-service-1  | Executing (default): ALTER TABLE "StockReservations"  ADD FOREIGN KEY ("ProductId") REFERENCES "Products" ("id") ON DELETE SET NULL ON UPDATE CASCADE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'StockReservations' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'ProcessedEvents'
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'ProcessedEvents' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'ProcessedEvents' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" TYPE VARCHAR(255);
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'ProcessedEvents' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Database synced
product-service-1  | Kafka producer connected for product-service
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T18:23:33.693Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T18:24:02.368Z","logger":"kafkajs","message":"[ConsumerGroup] Consumer has joined the group","groupId":"product-group","memberId":"kafkajs-a2a565a2-6994-4060-a8e7-8fe3295d40c6","leaderId":"kafkajs-a2a565a2-6994-4060-a8e7-8fe3295d40c6","isLeader":true,"memberAssignment":{"order-events":[0]},"groupProtocol":"RoundRobinAssigner","duration":28675}
product-service-1  | Attempt 1 to start Kafka client failed, retrying in 1000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 2 to start Kafka client failed, retrying in 2000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 3 to start Kafka client failed, retrying in 4000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 4 to start Kafka client failed, retrying in 8000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 5 to start Kafka client failed, retrying in 16000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 6 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | {"level":"WARN","timestamp":"2026-02-25T18:50:36.468Z","logger":"kafkajs","message":"[RequestQueue] Response without match","clientId":"kafkajs","broker":"kafka:9092","correlationId":11}
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 7 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | {"level":"WARN","timestamp":"2026-02-25T18:54:42.497Z","logger":"kafkajs","message":"[RequestQueue] Response without match","clientId":"kafkajs","broker":"kafka:9092","correlationId":17}
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 8 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Failed to start Kafka consumer after retries { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Error starting Kafka consumer: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
product-service-1  |     at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
product-service-1  |     at startKafkaConsumer (/app/index.js:498:24)
product-service-1  |     at async start (/app/index.js:538:5) {
product-service-1  |   retriable: false,
product-service-1  |   helpUrl: undefined,
product-service-1  |   [cause]: undefined
product-service-1  | }
product-service-1  | Startup error: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
product-service-1  |     at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
product-service-1  |     at startKafkaConsumer (/app/index.js:498:24)
product-service-1  |     at async start (/app/index.js:538:5) {
product-service-1  |   retriable: false,
product-service-1  |   helpUrl: undefined,
product-service-1  |   [cause]: undefined
product-service-1  | }
product-service-1  | 
product-service-1  | > product-service@1.0.0 start
product-service-1  | > node index.js
product-service-1  | 
product-service-1  | [dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }
product-service-1  | {"level":"WARN","timestamp":"2026-02-25T18:54:46.071Z","logger":"kafkajs","message":"KafkaJS v2.0.0 switched default partitioner. To retain the same partitioning behavior as in previous versions, create the producer with the option \"createPartitioner: Partitioners.LegacyPartitioner\". See the migration guide at https://kafka.js.org/docs/migration-guide-v2.0.0#producer-new-default-partitioner for details. Silence this warning by setting the environment variable \"KAFKAJS_NO_PARTITIONER_WARNING=1\""}
product-service-1  | Product Service running on port 3002
product-service-1  | Executing (default): SELECT 1+1 AS result
product-service-1  | Database connected successfully
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'Products'
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'Products' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'Products' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "name" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "name" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "name" TYPE VARCHAR(255);
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "stock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "stock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "stock" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "reservedStock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "reservedStock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "reservedStock" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "version" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "version" SET DEFAULT 1;ALTER TABLE "Products" ALTER COLUMN "version" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'Products' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'StockReservations'
product-service-1  | Executing (default): SELECT t.typname enum_name, array_agg(e.enumlabel ORDER BY enumsortorder) enum_value FROM pg_type t JOIN pg_enum e ON t.oid = e.enumtypid JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace WHERE n.nspname = 'public' AND t.typname='enum_StockReservations_status' GROUP BY 1
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'StockReservations' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'StockReservations' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "orderId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "orderId" DROP DEFAULT;ALTER TABLE "StockReservations"  ADD UNIQUE ("orderId");ALTER TABLE "StockReservations" ALTER COLUMN "orderId" TYPE INTEGER  ;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "productId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "productId" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "productId" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "quantity" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "status" DROP NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "status" SET DEFAULT 'RESERVED';DO 'BEGIN CREATE TYPE "public"."enum_StockReservations_status" AS ENUM(''RESERVED'', ''CONFIRMED'', ''RELEASED''); EXCEPTION WHEN duplicate_object THEN null; END';ALTER TABLE "StockReservations" ALTER COLUMN "status" TYPE "public"."enum_StockReservations_status" USING ("status"::"public"."enum_StockReservations_status");
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" DROP CONSTRAINT "StockReservations_ProductId_fkey"
product-service-1  | Executing (default): ALTER TABLE "StockReservations"  ADD FOREIGN KEY ("ProductId") REFERENCES "Products" ("id") ON DELETE SET NULL ON UPDATE CASCADE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'StockReservations' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'ProcessedEvents'
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'ProcessedEvents' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'ProcessedEvents' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" TYPE VARCHAR(255);
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'ProcessedEvents' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Database synced
product-service-1  | Kafka producer connected for product-service
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T18:54:46.236Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T18:55:07.502Z","logger":"kafkajs","message":"[ConsumerGroup] Consumer has joined the group","groupId":"product-group","memberId":"kafkajs-71646742-b7d1-4e37-bd5e-4ad9bd8578cf","leaderId":"kafkajs-71646742-b7d1-4e37-bd5e-4ad9bd8578cf","isLeader":true,"memberAssignment":{"order-events":[0]},"groupProtocol":"RoundRobinAssigner","duration":21266}
product-service-1  | Attempt 1 to start Kafka client failed, retrying in 1000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 2 to start Kafka client failed, retrying in 2000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 3 to start Kafka client failed, retrying in 4000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | {"level":"WARN","timestamp":"2026-02-25T20:20:01.118Z","logger":"kafkajs","message":"[RequestQueue] Response without match","clientId":"kafkajs","broker":"kafka:9092","correlationId":0}
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 4 to start Kafka client failed, retrying in 8000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 5 to start Kafka client failed, retrying in 16000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 6 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 7 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | {"level":"WARN","timestamp":"2026-02-25T20:31:03.210Z","logger":"kafkajs","message":"[RequestQueue] Response without match","clientId":"kafkajs","broker":"kafka:9092","correlationId":11}
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 8 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Failed to start Kafka consumer after retries { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Error starting Kafka consumer: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
product-service-1  |     at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
product-service-1  |     at startKafkaConsumer (/app/index.js:498:24)
product-service-1  |     at async start (/app/index.js:538:5) {
product-service-1  |   retriable: false,
product-service-1  |   helpUrl: undefined,
product-service-1  |   [cause]: undefined
product-service-1  | }
product-service-1  | Startup error: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
product-service-1  |     at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
product-service-1  |     at startKafkaConsumer (/app/index.js:498:24)
product-service-1  |     at async start (/app/index.js:538:5) {
product-service-1  |   retriable: false,
product-service-1  |   helpUrl: undefined,
product-service-1  |   [cause]: undefined
product-service-1  | }
product-service-1  | 
product-service-1  | > product-service@1.0.0 start
product-service-1  | > node index.js
product-service-1  | 
product-service-1  | [dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit
product-service-1  | {"level":"WARN","timestamp":"2026-02-25T20:51:42.430Z","logger":"kafkajs","message":"KafkaJS v2.0.0 switched default partitioner. To retain the same partitioning behavior as in previous versions, create the producer with the option \"createPartitioner: Partitioners.LegacyPartitioner\". See the migration guide at https://kafka.js.org/docs/migration-guide-v2.0.0#producer-new-default-partitioner for details. Silence this warning by setting the environment variable \"KAFKAJS_NO_PARTITIONER_WARNING=1\""}
product-service-1  | Product Service running on port 3002
product-service-1  | Executing (default): SELECT 1+1 AS result
product-service-1  | Database connected successfully
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'Products'
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'Products' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'Products' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "name" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "name" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "name" TYPE VARCHAR(255);
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "stock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "stock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "stock" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "reservedStock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "reservedStock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "reservedStock" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "version" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "version" SET DEFAULT 1;ALTER TABLE "Products" ALTER COLUMN "version" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'Products' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'StockReservations'
product-service-1  | Executing (default): SELECT t.typname enum_name, array_agg(e.enumlabel ORDER BY enumsortorder) enum_value FROM pg_type t JOIN pg_enum e ON t.oid = e.enumtypid JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace WHERE n.nspname = 'public' AND t.typname='enum_StockReservations_status' GROUP BY 1
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'StockReservations' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'StockReservations' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "orderId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "orderId" DROP DEFAULT;ALTER TABLE "StockReservations"  ADD UNIQUE ("orderId");ALTER TABLE "StockReservations" ALTER COLUMN "orderId" TYPE INTEGER  ;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "productId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "productId" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "productId" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "quantity" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "status" DROP NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "status" SET DEFAULT 'RESERVED';DO 'BEGIN CREATE TYPE "public"."enum_StockReservations_status" AS ENUM(''RESERVED'', ''CONFIRMED'', ''RELEASED''); EXCEPTION WHEN duplicate_object THEN null; END';ALTER TABLE "StockReservations" ALTER COLUMN "status" TYPE "public"."enum_StockReservations_status" USING ("status"::"public"."enum_StockReservations_status");
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" DROP CONSTRAINT "StockReservations_ProductId_fkey"
product-service-1  | Executing (default): ALTER TABLE "StockReservations"  ADD FOREIGN KEY ("ProductId") REFERENCES "Products" ("id") ON DELETE SET NULL ON UPDATE CASCADE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'StockReservations' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'ProcessedEvents'
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'ProcessedEvents' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'ProcessedEvents' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" TYPE VARCHAR(255);
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'ProcessedEvents' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Database synced
product-service-1  | Kafka producer connected for product-service
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T20:51:44.199Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T20:52:00.161Z","logger":"kafkajs","message":"[ConsumerGroup] Consumer has joined the group","groupId":"product-group","memberId":"kafkajs-63f3a2fe-4dfb-4dfd-a0c2-fc7b97d34c68","leaderId":"kafkajs-63f3a2fe-4dfb-4dfd-a0c2-fc7b97d34c68","isLeader":true,"memberAssignment":{"order-events":[0]},"groupProtocol":"RoundRobinAssigner","duration":15956}
product-service-1  | Attempt 1 to start Kafka client failed, retrying in 1000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 2 to start Kafka client failed, retrying in 2000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 3 to start Kafka client failed, retrying in 4000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 4 to start Kafka client failed, retrying in 8000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 5 to start Kafka client failed, retrying in 16000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 6 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | {"level":"WARN","timestamp":"2026-02-25T21:52:53.019Z","logger":"kafkajs","message":"[RequestQueue] Response without match","clientId":"kafkajs","broker":"kafka:9092","correlationId":6}
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 7 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Kafka producer connected for product-service
product-service-1  | Attempt 8 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Failed to start Kafka consumer after retries { error: 'Cannot subscribe to topic while consumer is running' }
product-service-1  | Error starting Kafka consumer: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
product-service-1  |     at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
product-service-1  |     at startKafkaConsumer (/app/index.js:498:24)
product-service-1  |     at async start (/app/index.js:538:5) {
product-service-1  |   retriable: false,
product-service-1  |   helpUrl: undefined,
product-service-1  |   [cause]: undefined
product-service-1  | }
product-service-1  | Startup error: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
product-service-1  |     at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
product-service-1  |     at startKafkaConsumer (/app/index.js:498:24)
product-service-1  |     at async start (/app/index.js:538:5) {
product-service-1  |   retriable: false,
product-service-1  |   helpUrl: undefined,
product-service-1  |   [cause]: undefined
product-service-1  | }
product-service-1  | 
product-service-1  | > product-service@1.0.0 start
product-service-1  | > node index.js
product-service-1  | 
product-service-1  | [dotenv@17.2.3] injecting env (0) from .env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops
product-service-1  | {"level":"WARN","timestamp":"2026-02-25T22:27:31.871Z","logger":"kafkajs","message":"KafkaJS v2.0.0 switched default partitioner. To retain the same partitioning behavior as in previous versions, create the producer with the option \"createPartitioner: Partitioners.LegacyPartitioner\". See the migration guide at https://kafka.js.org/docs/migration-guide-v2.0.0#producer-new-default-partitioner for details. Silence this warning by setting the environment variable \"KAFKAJS_NO_PARTITIONER_WARNING=1\""}
product-service-1  | Product Service running on port 3002
product-service-1  | Executing (default): SELECT 1+1 AS result
product-service-1  | Database connected successfully
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'Products'
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'Products' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'Products' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "name" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "name" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "name" TYPE VARCHAR(255);
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "stock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "stock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "stock" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "reservedStock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "reservedStock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "reservedStock" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "version" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "version" SET DEFAULT 1;ALTER TABLE "Products" ALTER COLUMN "version" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "Products" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'Products' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'StockReservations'
product-service-1  | Executing (default): SELECT t.typname enum_name, array_agg(e.enumlabel ORDER BY enumsortorder) enum_value FROM pg_type t JOIN pg_enum e ON t.oid = e.enumtypid JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace WHERE n.nspname = 'public' AND t.typname='enum_StockReservations_status' GROUP BY 1
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'StockReservations' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'StockReservations' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "orderId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "orderId" DROP DEFAULT;ALTER TABLE "StockReservations"  ADD UNIQUE ("orderId");ALTER TABLE "StockReservations" ALTER COLUMN "orderId" TYPE INTEGER  ;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "productId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "productId" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "productId" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "quantity" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" TYPE INTEGER;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "status" DROP NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "status" SET DEFAULT 'RESERVED';DO 'BEGIN CREATE TYPE "public"."enum_StockReservations_status" AS ENUM(''RESERVED'', ''CONFIRMED'', ''RELEASED''); EXCEPTION WHEN duplicate_object THEN null; END';ALTER TABLE "StockReservations" ALTER COLUMN "status" TYPE "public"."enum_StockReservations_status" USING ("status"::"public"."enum_StockReservations_status");
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "StockReservations" DROP CONSTRAINT "StockReservations_ProductId_fkey"
product-service-1  | Executing (default): ALTER TABLE "StockReservations"  ADD FOREIGN KEY ("ProductId") REFERENCES "Products" ("id") ON DELETE SET NULL ON UPDATE CASCADE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'StockReservations' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'ProcessedEvents'
product-service-1  | Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'ProcessedEvents' AND c.table_schema = 'public'
product-service-1  | Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'ProcessedEvents' AND tc.table_catalog = 'products_db'
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" TYPE VARCHAR(255);
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
product-service-1  | Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'ProcessedEvents' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
product-service-1  | Database synced
product-service-1  | Kafka producer connected for product-service
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T22:27:32.131Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
product-service-1  | {"level":"ERROR","timestamp":"2026-02-25T22:53:56.093Z","logger":"kafkajs","message":"[Consumer] Crash: KafkaJSRequestTimeoutError: Request JoinGroup(key: 11, version: 5) timed out","groupId":"product-group","stack":"KafkaJSRequestTimeoutError: Request JoinGroup(key: 11, version: 5) timed out\n    at SocketRequest.timeoutRequest (/app/node_modules/kafkajs/src/network/requestQueue/socketRequest.js:107:19)\n    at /app/node_modules/kafkajs/src/network/requestQueue/index.js:94:21\n    at Map.forEach (<anonymous>)\n    at Timeout._onTimeout (/app/node_modules/kafkajs/src/network/requestQueue/index.js:92:23)\n    at listOnTimeout (node:internal/timers:569:17)\n    at process.processTimers (node:internal/timers:512:7)"}
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T22:53:56.094Z","logger":"kafkajs","message":"[Consumer] Stopped","groupId":"product-group"}
product-service-1  | {"level":"ERROR","timestamp":"2026-02-25T22:53:56.096Z","logger":"kafkajs","message":"[Consumer] Restarting the consumer in 300ms","retryTime":300,"groupId":"product-group"}
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T22:53:56.108Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T22:53:56.399Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
product-service-1  | {"level":"WARN","timestamp":"2026-02-25T22:54:21.582Z","logger":"kafkajs","message":"[RequestQueue] Response without match","clientId":"kafkajs","broker":"kafka:9092","correlationId":4}
product-service-1  | {"level":"ERROR","timestamp":"2026-02-25T22:54:21.590Z","logger":"kafkajs","message":"[Consumer] Crash: KafkaJSGroupCoordinatorNotFound: Failed to find group coordinator","groupId":"product-group","stack":"KafkaJSGroupCoordinatorNotFound: Failed to find group coordinator\n    at Cluster.findGroupCoordinatorMetadata (/app/node_modules/kafkajs/src/cluster/index.js:420:11)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async /app/node_modules/kafkajs/src/cluster/index.js:346:33\n    at async [private:ConsumerGroup:join] (/app/node_modules/kafkajs/src/consumer/consumerGroup.js:167:24)\n    at async /app/node_modules/kafkajs/src/consumer/consumerGroup.js:335:9\n    at async Runner.start (/app/node_modules/kafkajs/src/consumer/runner.js:84:7)\n    at async start (/app/node_modules/kafkajs/src/consumer/index.js:243:7)"}
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T22:54:21.590Z","logger":"kafkajs","message":"[Consumer] Stopped","groupId":"product-group"}
product-service-1  | {"level":"ERROR","timestamp":"2026-02-25T22:54:21.591Z","logger":"kafkajs","message":"[Consumer] Crash: KafkaJSConnectionClosedError: Closed connection","groupId":"product-group","stack":"KafkaJSConnectionClosedError: Closed connection\n    at Socket.onEnd (/app/node_modules/kafkajs/src/network/connection.js:197:13)\n    at Socket.emit (node:events:529:35)\n    at endReadableNT (node:internal/streams/readable:1400:12)\n    at process.processTicksAndRejections (node:internal/process/task_queues:82:21)"}
product-service-1  | {"level":"ERROR","timestamp":"2026-02-25T22:54:21.591Z","logger":"kafkajs","message":"[Consumer] Restarting the consumer in 300ms","retryTime":300,"groupId":"product-group"}
product-service-1  | Kafka consumer started successfully
product-service-1  | {"level":"WARN","timestamp":"2026-02-25T22:54:21.592Z","logger":"kafkajs","message":"[RequestQueue] Response without match","clientId":"kafkajs","broker":"kafka:9092","correlationId":9}
product-service-1  | {"level":"WARN","timestamp":"2026-02-25T22:54:21.592Z","logger":"kafkajs","message":"[RequestQueue] Response without match","clientId":"kafkajs","broker":"kafka:9092","correlationId":10}
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T22:54:21.892Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
product-service-1  | {"level":"ERROR","timestamp":"2026-02-25T23:27:12.803Z","logger":"kafkajs","message":"[Consumer] Crash: KafkaJSRequestTimeoutError: Request JoinGroup(key: 11, version: 5) timed out","groupId":"product-group","stack":"KafkaJSRequestTimeoutError: Request JoinGroup(key: 11, version: 5) timed out\n    at SocketRequest.timeoutRequest (/app/node_modules/kafkajs/src/network/requestQueue/socketRequest.js:107:19)\n    at /app/node_modules/kafkajs/src/network/requestQueue/index.js:94:21\n    at Map.forEach (<anonymous>)\n    at Timeout._onTimeout (/app/node_modules/kafkajs/src/network/requestQueue/index.js:92:23)\n    at listOnTimeout (node:internal/timers:569:17)\n    at process.processTimers (node:internal/timers:512:7)"}
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T23:27:12.805Z","logger":"kafkajs","message":"[Consumer] Stopped","groupId":"product-group"}
product-service-1  | {"level":"ERROR","timestamp":"2026-02-25T23:27:12.806Z","logger":"kafkajs","message":"[Consumer] Restarting the consumer in 300ms","retryTime":300,"groupId":"product-group"}
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T23:27:13.106Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
product-service-1  | {"level":"WARN","timestamp":"2026-02-25T23:27:38.294Z","logger":"kafkajs","message":"[RequestQueue] Response without match","clientId":"kafkajs","broker":"kafka:9092","correlationId":4}
product-service-1  | {"level":"ERROR","timestamp":"2026-02-25T23:27:38.299Z","logger":"kafkajs","message":"[Consumer] Crash: KafkaJSConnectionClosedError: Closed connection","groupId":"product-group","stack":"KafkaJSConnectionClosedError: Closed connection\n    at Socket.onEnd (/app/node_modules/kafkajs/src/network/connection.js:197:13)\n    at Socket.emit (node:events:529:35)\n    at endReadableNT (node:internal/streams/readable:1400:12)\n    at process.processTicksAndRejections (node:internal/process/task_queues:82:21)"}
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T23:27:38.299Z","logger":"kafkajs","message":"[Consumer] Stopped","groupId":"product-group"}
product-service-1  | {"level":"ERROR","timestamp":"2026-02-25T23:27:38.299Z","logger":"kafkajs","message":"[Consumer] Restarting the consumer in 300ms","retryTime":300,"groupId":"product-group"}
product-service-1  | {"level":"WARN","timestamp":"2026-02-25T23:27:38.306Z","logger":"kafkajs","message":"[RequestQueue] Response without match","clientId":"kafkajs","broker":"kafka:9092","correlationId":9}
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T23:27:38.600Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
product-service-1  | {"level":"ERROR","timestamp":"2026-02-25T23:54:18.499Z","logger":"kafkajs","message":"[Consumer] Crash: KafkaJSRequestTimeoutError: Request JoinGroup(key: 11, version: 5) timed out","groupId":"product-group","stack":"KafkaJSRequestTimeoutError: Request JoinGroup(key: 11, version: 5) timed out\n    at SocketRequest.timeoutRequest (/app/node_modules/kafkajs/src/network/requestQueue/socketRequest.js:107:19)\n    at /app/node_modules/kafkajs/src/network/requestQueue/index.js:94:21\n    at Map.forEach (<anonymous>)\n    at Timeout._onTimeout (/app/node_modules/kafkajs/src/network/requestQueue/index.js:92:23)\n    at listOnTimeout (node:internal/timers:569:17)\n    at process.processTimers (node:internal/timers:512:7)"}
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T23:54:18.499Z","logger":"kafkajs","message":"[Consumer] Stopped","groupId":"product-group"}
product-service-1  | {"level":"ERROR","timestamp":"2026-02-25T23:54:18.500Z","logger":"kafkajs","message":"[Consumer] Restarting the consumer in 300ms","retryTime":300,"groupId":"product-group"}
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T23:54:18.799Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
product-service-1  | {"level":"WARN","timestamp":"2026-02-25T23:54:45.122Z","logger":"kafkajs","message":"[RequestQueue] Response without match","clientId":"kafkajs","broker":"kafka:9092","correlationId":4}
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T23:54:45.194Z","logger":"kafkajs","message":"[Consumer] Stopped","groupId":"product-group"}
product-service-1  | {"level":"ERROR","timestamp":"2026-02-25T23:54:45.193Z","logger":"kafkajs","message":"[Consumer] Crash: KafkaJSConnectionClosedError: Closed connection","groupId":"product-group","stack":"KafkaJSConnectionClosedError: Closed connection\n    at Socket.onEnd (/app/node_modules/kafkajs/src/network/connection.js:197:13)\n    at Socket.emit (node:events:529:35)\n    at endReadableNT (node:internal/streams/readable:1400:12)\n    at process.processTicksAndRejections (node:internal/process/task_queues:82:21)"}
product-service-1  | {"level":"ERROR","timestamp":"2026-02-25T23:54:45.194Z","logger":"kafkajs","message":"[Consumer] Restarting the consumer in 300ms","retryTime":300,"groupId":"product-group"}
product-service-1  | {"level":"WARN","timestamp":"2026-02-25T23:54:45.194Z","logger":"kafkajs","message":"[RequestQueue] Response without match","clientId":"kafkajs","broker":"kafka:9092","correlationId":9}
product-service-1  | {"level":"INFO","timestamp":"2026-02-25T23:54:45.494Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
product-service-1  | {"level":"INFO","timestamp":"2026-02-26T00:54:56.935Z","logger":"kafkajs","message":"[Consumer] Stopped","groupId":"product-group"}
product-service-1  | {"level":"ERROR","timestamp":"2026-02-26T00:54:56.935Z","logger":"kafkajs","message":"[Consumer] Crash: KafkaJSRequestTimeoutError: Request JoinGroup(key: 11, version: 5) timed out","groupId":"product-group","stack":"KafkaJSRequestTimeoutError: Request JoinGroup(key: 11, version: 5) timed out\n    at SocketRequest.timeoutRequest (/app/node_modules/kafkajs/src/network/requestQueue/socketRequest.js:107:19)\n    at /app/node_modules/kafkajs/src/network/requestQueue/index.js:94:21\n    at Map.forEach (<anonymous>)\n    at Timeout._onTimeout (/app/node_modules/kafkajs/src/network/requestQueue/index.js:92:23)\n    at listOnTimeout (node:internal/timers:569:17)\n    at process.processTimers (node:internal/timers:512:7)"}
product-service-1  | {"level":"ERROR","timestamp":"2026-02-26T00:54:56.936Z","logger":"kafkajs","message":"[Consumer] Restarting the consumer in 300ms","retryTime":300,"groupId":"product-group"}
product-service-1  | {"level":"INFO","timestamp":"2026-02-26T00:54:57.237Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
product-service-1  | npm error path /app
product-service-1  | npm error command failed
product-service-1  | npm error signal SIGTERM
product-service-1  | npm error command sh -c node index.js
product-service-1  | npm error A complete log of this run can be found in: /home/nodejs/.npm/_logs/2026-02-25T22_27_30_706Z-debug-0.log
