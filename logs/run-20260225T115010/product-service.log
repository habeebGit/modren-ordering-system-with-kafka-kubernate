
> product-service@1.0.0 start
> node index.js

[dotenv@17.2.3] injecting env (0) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops
{"level":"WARN","timestamp":"2026-02-25T11:44:12.643Z","logger":"kafkajs","message":"KafkaJS v2.0.0 switched default partitioner. To retain the same partitioning behavior as in previous versions, create the producer with the option \"createPartitioner: Partitioners.LegacyPartitioner\". See the migration guide at https://kafka.js.org/docs/migration-guide-v2.0.0#producer-new-default-partitioner for details. Silence this warning by setting the environment variable \"KAFKAJS_NO_PARTITIONER_WARNING=1\""}
Product Service running on port 3002
Executing (default): SELECT 1+1 AS result
Database connected successfully
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'Products'
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'Products' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'Products' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "Products" ALTER COLUMN "name" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "name" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "name" TYPE VARCHAR(255);
Executing (default): ALTER TABLE "Products" ALTER COLUMN "stock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "stock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "stock" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "reservedStock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "reservedStock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "reservedStock" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "version" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "version" SET DEFAULT 1;ALTER TABLE "Products" ALTER COLUMN "version" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'Products' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'StockReservations'
Executing (default): SELECT t.typname enum_name, array_agg(e.enumlabel ORDER BY enumsortorder) enum_value FROM pg_type t JOIN pg_enum e ON t.oid = e.enumtypid JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace WHERE n.nspname = 'public' AND t.typname='enum_StockReservations_status' GROUP BY 1
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'StockReservations' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'StockReservations' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "orderId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "orderId" DROP DEFAULT;ALTER TABLE "StockReservations"  ADD UNIQUE ("orderId");ALTER TABLE "StockReservations" ALTER COLUMN "orderId" TYPE INTEGER  ;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "productId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "productId" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "productId" TYPE INTEGER;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "quantity" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" TYPE INTEGER;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "status" DROP NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "status" SET DEFAULT 'RESERVED';DO 'BEGIN CREATE TYPE "public"."enum_StockReservations_status" AS ENUM(''RESERVED'', ''CONFIRMED'', ''RELEASED''); EXCEPTION WHEN duplicate_object THEN null; END';ALTER TABLE "StockReservations" ALTER COLUMN "status" TYPE "public"."enum_StockReservations_status" USING ("status"::"public"."enum_StockReservations_status");
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" DROP CONSTRAINT "StockReservations_ProductId_fkey"
Executing (default): ALTER TABLE "StockReservations"  ADD FOREIGN KEY ("ProductId") REFERENCES "Products" ("id") ON DELETE SET NULL ON UPDATE CASCADE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'StockReservations' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'ProcessedEvents'
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'ProcessedEvents' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'ProcessedEvents' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" TYPE VARCHAR(255);
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'ProcessedEvents' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Database synced
Kafka producer connected for product-service
{"level":"INFO","timestamp":"2026-02-25T11:44:12.765Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
{"level":"INFO","timestamp":"2026-02-25T11:44:37.807Z","logger":"kafkajs","message":"[ConsumerGroup] Consumer has joined the group","groupId":"product-group","memberId":"kafkajs-461c0a3b-2a4a-45b2-809c-6ebdeeeac3c1","leaderId":"kafkajs-461c0a3b-2a4a-45b2-809c-6ebdeeeac3c1","isLeader":true,"memberAssignment":{"order-events":[0]},"groupProtocol":"RoundRobinAssigner","duration":25042}
Attempt 1 to start Kafka client failed, retrying in 1000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 2 to start Kafka client failed, retrying in 2000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 3 to start Kafka client failed, retrying in 4000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 4 to start Kafka client failed, retrying in 8000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 5 to start Kafka client failed, retrying in 16000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 6 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 7 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 8 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
Failed to start Kafka consumer after retries { error: 'Cannot subscribe to topic while consumer is running' }
Error starting Kafka consumer: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
    at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
    at startKafkaConsumer (/app/index.js:498:24)
    at runNextTicks (node:internal/process/task_queues:60:5)
    at process.processTimers (node:internal/timers:509:9)
    at async start (/app/index.js:538:5) {
  retriable: false,
  helpUrl: undefined,
  [cause]: undefined
}
Startup error: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
    at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
    at startKafkaConsumer (/app/index.js:498:24)
    at runNextTicks (node:internal/process/task_queues:60:5)
    at process.processTimers (node:internal/timers:509:9)
    at async start (/app/index.js:538:5) {
  retriable: false,
  helpUrl: undefined,
  [cause]: undefined
}
npm notice
npm notice New major version of npm available! 10.8.2 -> 11.10.1
npm notice Changelog: https://github.com/npm/cli/releases/tag/v11.10.1
npm notice To update run: npm install -g npm@11.10.1
npm notice

> product-service@1.0.0 start
> node index.js

[dotenv@17.2.3] injecting env (0) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops
{"level":"WARN","timestamp":"2026-02-25T11:46:09.656Z","logger":"kafkajs","message":"KafkaJS v2.0.0 switched default partitioner. To retain the same partitioning behavior as in previous versions, create the producer with the option \"createPartitioner: Partitioners.LegacyPartitioner\". See the migration guide at https://kafka.js.org/docs/migration-guide-v2.0.0#producer-new-default-partitioner for details. Silence this warning by setting the environment variable \"KAFKAJS_NO_PARTITIONER_WARNING=1\""}
Product Service running on port 3002
Executing (default): SELECT 1+1 AS result
Database connected successfully
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'Products'
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'Products' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'Products' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "Products" ALTER COLUMN "name" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "name" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "name" TYPE VARCHAR(255);
Executing (default): ALTER TABLE "Products" ALTER COLUMN "stock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "stock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "stock" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "reservedStock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "reservedStock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "reservedStock" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "version" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "version" SET DEFAULT 1;ALTER TABLE "Products" ALTER COLUMN "version" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'Products' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'StockReservations'
Executing (default): SELECT t.typname enum_name, array_agg(e.enumlabel ORDER BY enumsortorder) enum_value FROM pg_type t JOIN pg_enum e ON t.oid = e.enumtypid JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace WHERE n.nspname = 'public' AND t.typname='enum_StockReservations_status' GROUP BY 1
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'StockReservations' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'StockReservations' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "orderId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "orderId" DROP DEFAULT;ALTER TABLE "StockReservations"  ADD UNIQUE ("orderId");ALTER TABLE "StockReservations" ALTER COLUMN "orderId" TYPE INTEGER  ;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "productId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "productId" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "productId" TYPE INTEGER;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "quantity" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" TYPE INTEGER;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "status" DROP NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "status" SET DEFAULT 'RESERVED';DO 'BEGIN CREATE TYPE "public"."enum_StockReservations_status" AS ENUM(''RESERVED'', ''CONFIRMED'', ''RELEASED''); EXCEPTION WHEN duplicate_object THEN null; END';ALTER TABLE "StockReservations" ALTER COLUMN "status" TYPE "public"."enum_StockReservations_status" USING ("status"::"public"."enum_StockReservations_status");
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" DROP CONSTRAINT "StockReservations_ProductId_fkey"
Executing (default): ALTER TABLE "StockReservations"  ADD FOREIGN KEY ("ProductId") REFERENCES "Products" ("id") ON DELETE SET NULL ON UPDATE CASCADE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'StockReservations' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'ProcessedEvents'
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'ProcessedEvents' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'ProcessedEvents' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" TYPE VARCHAR(255);
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'ProcessedEvents' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Database synced
Kafka producer connected for product-service
{"level":"INFO","timestamp":"2026-02-25T11:46:09.770Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
{"level":"INFO","timestamp":"2026-02-25T11:46:38.337Z","logger":"kafkajs","message":"[ConsumerGroup] Consumer has joined the group","groupId":"product-group","memberId":"kafkajs-87d3b683-ad23-4c0b-bf51-d2e676f8fbbf","leaderId":"kafkajs-87d3b683-ad23-4c0b-bf51-d2e676f8fbbf","isLeader":true,"memberAssignment":{"order-events":[0]},"groupProtocol":"RoundRobinAssigner","duration":28566}
Attempt 1 to start Kafka client failed, retrying in 1000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 2 to start Kafka client failed, retrying in 2000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 3 to start Kafka client failed, retrying in 4000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 4 to start Kafka client failed, retrying in 8000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 5 to start Kafka client failed, retrying in 16000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 6 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 7 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 8 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
Failed to start Kafka consumer after retries { error: 'Cannot subscribe to topic while consumer is running' }
Error starting Kafka consumer: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
    at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
    at startKafkaConsumer (/app/index.js:498:24)
    at runNextTicks (node:internal/process/task_queues:60:5)
    at process.processTimers (node:internal/timers:509:9)
    at async start (/app/index.js:538:5) {
  retriable: false,
  helpUrl: undefined,
  [cause]: undefined
}
Startup error: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
    at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
    at startKafkaConsumer (/app/index.js:498:24)
    at runNextTicks (node:internal/process/task_queues:60:5)
    at process.processTimers (node:internal/timers:509:9)
    at async start (/app/index.js:538:5) {
  retriable: false,
  helpUrl: undefined,
  [cause]: undefined
}

> product-service@1.0.0 start
> node index.js

[dotenv@17.2.3] injecting env (0) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com
{"level":"WARN","timestamp":"2026-02-25T11:48:10.066Z","logger":"kafkajs","message":"KafkaJS v2.0.0 switched default partitioner. To retain the same partitioning behavior as in previous versions, create the producer with the option \"createPartitioner: Partitioners.LegacyPartitioner\". See the migration guide at https://kafka.js.org/docs/migration-guide-v2.0.0#producer-new-default-partitioner for details. Silence this warning by setting the environment variable \"KAFKAJS_NO_PARTITIONER_WARNING=1\""}
Product Service running on port 3002
Executing (default): SELECT 1+1 AS result
Database connected successfully
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'Products'
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'Products' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'Products' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "Products" ALTER COLUMN "name" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "name" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "name" TYPE VARCHAR(255);
Executing (default): ALTER TABLE "Products" ALTER COLUMN "stock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "stock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "stock" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "reservedStock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "reservedStock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "reservedStock" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "version" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "version" SET DEFAULT 1;ALTER TABLE "Products" ALTER COLUMN "version" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'Products' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'StockReservations'
Executing (default): SELECT t.typname enum_name, array_agg(e.enumlabel ORDER BY enumsortorder) enum_value FROM pg_type t JOIN pg_enum e ON t.oid = e.enumtypid JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace WHERE n.nspname = 'public' AND t.typname='enum_StockReservations_status' GROUP BY 1
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'StockReservations' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'StockReservations' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "orderId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "orderId" DROP DEFAULT;ALTER TABLE "StockReservations"  ADD UNIQUE ("orderId");ALTER TABLE "StockReservations" ALTER COLUMN "orderId" TYPE INTEGER  ;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "productId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "productId" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "productId" TYPE INTEGER;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "quantity" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" TYPE INTEGER;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "status" DROP NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "status" SET DEFAULT 'RESERVED';DO 'BEGIN CREATE TYPE "public"."enum_StockReservations_status" AS ENUM(''RESERVED'', ''CONFIRMED'', ''RELEASED''); EXCEPTION WHEN duplicate_object THEN null; END';ALTER TABLE "StockReservations" ALTER COLUMN "status" TYPE "public"."enum_StockReservations_status" USING ("status"::"public"."enum_StockReservations_status");
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" DROP CONSTRAINT "StockReservations_ProductId_fkey"
Executing (default): ALTER TABLE "StockReservations"  ADD FOREIGN KEY ("ProductId") REFERENCES "Products" ("id") ON DELETE SET NULL ON UPDATE CASCADE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'StockReservations' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'ProcessedEvents'
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'ProcessedEvents' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'ProcessedEvents' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" TYPE VARCHAR(255);
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'ProcessedEvents' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Database synced
Kafka producer connected for product-service
{"level":"INFO","timestamp":"2026-02-25T11:48:10.166Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
{"level":"INFO","timestamp":"2026-02-25T11:48:38.904Z","logger":"kafkajs","message":"[ConsumerGroup] Consumer has joined the group","groupId":"product-group","memberId":"kafkajs-af7c0c7b-481f-4c09-827f-32dbfb29a571","leaderId":"kafkajs-af7c0c7b-481f-4c09-827f-32dbfb29a571","isLeader":true,"memberAssignment":{"order-events":[0]},"groupProtocol":"RoundRobinAssigner","duration":28737}
Attempt 1 to start Kafka client failed, retrying in 1000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 2 to start Kafka client failed, retrying in 2000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 3 to start Kafka client failed, retrying in 4000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 4 to start Kafka client failed, retrying in 8000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 5 to start Kafka client failed, retrying in 16000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 6 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 7 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 8 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
Failed to start Kafka consumer after retries { error: 'Cannot subscribe to topic while consumer is running' }
Error starting Kafka consumer: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
    at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
    at startKafkaConsumer (/app/index.js:498:24)
    at runNextTicks (node:internal/process/task_queues:60:5)
    at process.processTimers (node:internal/timers:509:9)
    at async start (/app/index.js:538:5) {
  retriable: false,
  helpUrl: undefined,
  [cause]: undefined
}
Startup error: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
    at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
    at startKafkaConsumer (/app/index.js:498:24)
    at runNextTicks (node:internal/process/task_queues:60:5)
    at process.processTimers (node:internal/timers:509:9)
    at async start (/app/index.js:538:5) {
  retriable: false,
  helpUrl: undefined,
  [cause]: undefined
}

> product-service@1.0.0 start
> node index.js

[dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit
{"level":"WARN","timestamp":"2026-02-25T11:50:10.670Z","logger":"kafkajs","message":"KafkaJS v2.0.0 switched default partitioner. To retain the same partitioning behavior as in previous versions, create the producer with the option \"createPartitioner: Partitioners.LegacyPartitioner\". See the migration guide at https://kafka.js.org/docs/migration-guide-v2.0.0#producer-new-default-partitioner for details. Silence this warning by setting the environment variable \"KAFKAJS_NO_PARTITIONER_WARNING=1\""}
Product Service running on port 3002
Executing (default): SELECT 1+1 AS result
Database connected successfully
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'Products'
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'Products' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'Products' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "Products" ALTER COLUMN "name" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "name" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "name" TYPE VARCHAR(255);
Executing (default): ALTER TABLE "Products" ALTER COLUMN "stock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "stock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "stock" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "reservedStock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "reservedStock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "reservedStock" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "version" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "version" SET DEFAULT 1;ALTER TABLE "Products" ALTER COLUMN "version" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'Products' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'StockReservations'
Executing (default): SELECT t.typname enum_name, array_agg(e.enumlabel ORDER BY enumsortorder) enum_value FROM pg_type t JOIN pg_enum e ON t.oid = e.enumtypid JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace WHERE n.nspname = 'public' AND t.typname='enum_StockReservations_status' GROUP BY 1
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'StockReservations' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'StockReservations' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "orderId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "orderId" DROP DEFAULT;ALTER TABLE "StockReservations"  ADD UNIQUE ("orderId");ALTER TABLE "StockReservations" ALTER COLUMN "orderId" TYPE INTEGER  ;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "productId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "productId" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "productId" TYPE INTEGER;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "quantity" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" TYPE INTEGER;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "status" DROP NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "status" SET DEFAULT 'RESERVED';DO 'BEGIN CREATE TYPE "public"."enum_StockReservations_status" AS ENUM(''RESERVED'', ''CONFIRMED'', ''RELEASED''); EXCEPTION WHEN duplicate_object THEN null; END';ALTER TABLE "StockReservations" ALTER COLUMN "status" TYPE "public"."enum_StockReservations_status" USING ("status"::"public"."enum_StockReservations_status");
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" DROP CONSTRAINT "StockReservations_ProductId_fkey"
Executing (default): ALTER TABLE "StockReservations"  ADD FOREIGN KEY ("ProductId") REFERENCES "Products" ("id") ON DELETE SET NULL ON UPDATE CASCADE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'StockReservations' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'ProcessedEvents'
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'ProcessedEvents' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'ProcessedEvents' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" TYPE VARCHAR(255);
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'ProcessedEvents' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Database synced
Kafka producer connected for product-service
{"level":"INFO","timestamp":"2026-02-25T11:50:10.766Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
{"level":"INFO","timestamp":"2026-02-25T11:50:39.689Z","logger":"kafkajs","message":"[ConsumerGroup] Consumer has joined the group","groupId":"product-group","memberId":"kafkajs-36e6cb21-18f1-472a-bb36-cab263e728cf","leaderId":"kafkajs-36e6cb21-18f1-472a-bb36-cab263e728cf","isLeader":true,"memberAssignment":{"order-events":[0]},"groupProtocol":"RoundRobinAssigner","duration":28923}
Attempt 1 to start Kafka client failed, retrying in 1000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 2 to start Kafka client failed, retrying in 2000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 3 to start Kafka client failed, retrying in 4000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 4 to start Kafka client failed, retrying in 8000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 5 to start Kafka client failed, retrying in 16000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 6 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 7 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 8 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
Failed to start Kafka consumer after retries { error: 'Cannot subscribe to topic while consumer is running' }
Error starting Kafka consumer: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
    at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
    at startKafkaConsumer (/app/index.js:498:24)
    at async start (/app/index.js:538:5) {
  retriable: false,
  helpUrl: undefined,
  [cause]: undefined
}
Startup error: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
    at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
    at startKafkaConsumer (/app/index.js:498:24)
    at async start (/app/index.js:538:5) {
  retriable: false,
  helpUrl: undefined,
  [cause]: undefined
}

> product-service@1.0.0 start
> node index.js

[dotenv@17.2.3] injecting env (0) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com
{"level":"WARN","timestamp":"2026-02-25T11:52:11.367Z","logger":"kafkajs","message":"KafkaJS v2.0.0 switched default partitioner. To retain the same partitioning behavior as in previous versions, create the producer with the option \"createPartitioner: Partitioners.LegacyPartitioner\". See the migration guide at https://kafka.js.org/docs/migration-guide-v2.0.0#producer-new-default-partitioner for details. Silence this warning by setting the environment variable \"KAFKAJS_NO_PARTITIONER_WARNING=1\""}
Product Service running on port 3002
Executing (default): SELECT 1+1 AS result
Database connected successfully
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'Products'
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'Products' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'Products' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "Products" ALTER COLUMN "name" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "name" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "name" TYPE VARCHAR(255);
Executing (default): ALTER TABLE "Products" ALTER COLUMN "stock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "stock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "stock" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "reservedStock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "reservedStock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "reservedStock" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "version" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "version" SET DEFAULT 1;ALTER TABLE "Products" ALTER COLUMN "version" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'Products' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'StockReservations'
Executing (default): SELECT t.typname enum_name, array_agg(e.enumlabel ORDER BY enumsortorder) enum_value FROM pg_type t JOIN pg_enum e ON t.oid = e.enumtypid JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace WHERE n.nspname = 'public' AND t.typname='enum_StockReservations_status' GROUP BY 1
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'StockReservations' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'StockReservations' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "orderId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "orderId" DROP DEFAULT;ALTER TABLE "StockReservations"  ADD UNIQUE ("orderId");ALTER TABLE "StockReservations" ALTER COLUMN "orderId" TYPE INTEGER  ;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "productId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "productId" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "productId" TYPE INTEGER;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "quantity" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" TYPE INTEGER;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "status" DROP NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "status" SET DEFAULT 'RESERVED';DO 'BEGIN CREATE TYPE "public"."enum_StockReservations_status" AS ENUM(''RESERVED'', ''CONFIRMED'', ''RELEASED''); EXCEPTION WHEN duplicate_object THEN null; END';ALTER TABLE "StockReservations" ALTER COLUMN "status" TYPE "public"."enum_StockReservations_status" USING ("status"::"public"."enum_StockReservations_status");
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" DROP CONSTRAINT "StockReservations_ProductId_fkey"
Executing (default): ALTER TABLE "StockReservations"  ADD FOREIGN KEY ("ProductId") REFERENCES "Products" ("id") ON DELETE SET NULL ON UPDATE CASCADE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'StockReservations' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'ProcessedEvents'
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'ProcessedEvents' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'ProcessedEvents' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" TYPE VARCHAR(255);
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'ProcessedEvents' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Database synced
Kafka producer connected for product-service
{"level":"INFO","timestamp":"2026-02-25T11:52:11.458Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
{"level":"INFO","timestamp":"2026-02-25T11:52:40.258Z","logger":"kafkajs","message":"[ConsumerGroup] Consumer has joined the group","groupId":"product-group","memberId":"kafkajs-bcd59c78-5dad-48e8-bcaa-12966634cef2","leaderId":"kafkajs-bcd59c78-5dad-48e8-bcaa-12966634cef2","isLeader":true,"memberAssignment":{"order-events":[0]},"groupProtocol":"RoundRobinAssigner","duration":28800}
Attempt 1 to start Kafka client failed, retrying in 1000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 2 to start Kafka client failed, retrying in 2000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 3 to start Kafka client failed, retrying in 4000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 4 to start Kafka client failed, retrying in 8000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 5 to start Kafka client failed, retrying in 16000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 6 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 7 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 8 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
Failed to start Kafka consumer after retries { error: 'Cannot subscribe to topic while consumer is running' }
Error starting Kafka consumer: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
    at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
    at startKafkaConsumer (/app/index.js:498:24)
    at async start (/app/index.js:538:5) {
  retriable: false,
  helpUrl: undefined,
  [cause]: undefined
}
Startup error: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
    at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
    at startKafkaConsumer (/app/index.js:498:24)
    at async start (/app/index.js:538:5) {
  retriable: false,
  helpUrl: undefined,
  [cause]: undefined
}

> product-service@1.0.0 start
> node index.js

[dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild
{"level":"WARN","timestamp":"2026-02-25T11:54:12.180Z","logger":"kafkajs","message":"KafkaJS v2.0.0 switched default partitioner. To retain the same partitioning behavior as in previous versions, create the producer with the option \"createPartitioner: Partitioners.LegacyPartitioner\". See the migration guide at https://kafka.js.org/docs/migration-guide-v2.0.0#producer-new-default-partitioner for details. Silence this warning by setting the environment variable \"KAFKAJS_NO_PARTITIONER_WARNING=1\""}
Product Service running on port 3002
Executing (default): SELECT 1+1 AS result
Database connected successfully
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'Products'
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'Products' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'Products' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "Products" ALTER COLUMN "name" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "name" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "name" TYPE VARCHAR(255);
Executing (default): ALTER TABLE "Products" ALTER COLUMN "stock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "stock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "stock" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "reservedStock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "reservedStock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "reservedStock" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "version" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "version" SET DEFAULT 1;ALTER TABLE "Products" ALTER COLUMN "version" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'Products' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'StockReservations'
Executing (default): SELECT t.typname enum_name, array_agg(e.enumlabel ORDER BY enumsortorder) enum_value FROM pg_type t JOIN pg_enum e ON t.oid = e.enumtypid JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace WHERE n.nspname = 'public' AND t.typname='enum_StockReservations_status' GROUP BY 1
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'StockReservations' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'StockReservations' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "orderId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "orderId" DROP DEFAULT;ALTER TABLE "StockReservations"  ADD UNIQUE ("orderId");ALTER TABLE "StockReservations" ALTER COLUMN "orderId" TYPE INTEGER  ;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "productId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "productId" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "productId" TYPE INTEGER;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "quantity" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" TYPE INTEGER;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "status" DROP NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "status" SET DEFAULT 'RESERVED';DO 'BEGIN CREATE TYPE "public"."enum_StockReservations_status" AS ENUM(''RESERVED'', ''CONFIRMED'', ''RELEASED''); EXCEPTION WHEN duplicate_object THEN null; END';ALTER TABLE "StockReservations" ALTER COLUMN "status" TYPE "public"."enum_StockReservations_status" USING ("status"::"public"."enum_StockReservations_status");
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" DROP CONSTRAINT "StockReservations_ProductId_fkey"
Executing (default): ALTER TABLE "StockReservations"  ADD FOREIGN KEY ("ProductId") REFERENCES "Products" ("id") ON DELETE SET NULL ON UPDATE CASCADE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'StockReservations' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'ProcessedEvents'
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'ProcessedEvents' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'ProcessedEvents' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" TYPE VARCHAR(255);
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'ProcessedEvents' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Database synced
Kafka producer connected for product-service
{"level":"INFO","timestamp":"2026-02-25T11:54:12.320Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
{"level":"INFO","timestamp":"2026-02-25T11:54:40.825Z","logger":"kafkajs","message":"[ConsumerGroup] Consumer has joined the group","groupId":"product-group","memberId":"kafkajs-b675b376-d653-45f2-9b8b-3f6edb2e96a0","leaderId":"kafkajs-b675b376-d653-45f2-9b8b-3f6edb2e96a0","isLeader":true,"memberAssignment":{"order-events":[0]},"groupProtocol":"RoundRobinAssigner","duration":28504}
Attempt 1 to start Kafka client failed, retrying in 1000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 2 to start Kafka client failed, retrying in 2000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 3 to start Kafka client failed, retrying in 4000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 4 to start Kafka client failed, retrying in 8000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 5 to start Kafka client failed, retrying in 16000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 6 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 7 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
Executing (default): SELECT "id", "name", "stock", "reservedStock", "version", "createdAt", "updatedAt" FROM "Products" AS "Product";
Kafka producer connected for product-service
Attempt 8 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
Failed to start Kafka consumer after retries { error: 'Cannot subscribe to topic while consumer is running' }
Error starting Kafka consumer: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
    at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
    at startKafkaConsumer (/app/index.js:498:24)
    at runNextTicks (node:internal/process/task_queues:60:5)
    at process.processTimers (node:internal/timers:509:9)
    at async start (/app/index.js:538:5) {
  retriable: false,
  helpUrl: undefined,
  [cause]: undefined
}
Startup error: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
    at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
    at startKafkaConsumer (/app/index.js:498:24)
    at runNextTicks (node:internal/process/task_queues:60:5)
    at process.processTimers (node:internal/timers:509:9)
    at async start (/app/index.js:538:5) {
  retriable: false,
  helpUrl: undefined,
  [cause]: undefined
}

> product-service@1.0.0 start
> node index.js

[dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit
{"level":"WARN","timestamp":"2026-02-25T11:56:12.568Z","logger":"kafkajs","message":"KafkaJS v2.0.0 switched default partitioner. To retain the same partitioning behavior as in previous versions, create the producer with the option \"createPartitioner: Partitioners.LegacyPartitioner\". See the migration guide at https://kafka.js.org/docs/migration-guide-v2.0.0#producer-new-default-partitioner for details. Silence this warning by setting the environment variable \"KAFKAJS_NO_PARTITIONER_WARNING=1\""}
Product Service running on port 3002
Executing (default): SELECT 1+1 AS result
Database connected successfully
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'Products'
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'Products' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'Products' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "Products" ALTER COLUMN "name" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "name" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "name" TYPE VARCHAR(255);
Executing (default): ALTER TABLE "Products" ALTER COLUMN "stock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "stock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "stock" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "reservedStock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "reservedStock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "reservedStock" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "version" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "version" SET DEFAULT 1;ALTER TABLE "Products" ALTER COLUMN "version" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'Products' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'StockReservations'
Executing (default): SELECT t.typname enum_name, array_agg(e.enumlabel ORDER BY enumsortorder) enum_value FROM pg_type t JOIN pg_enum e ON t.oid = e.enumtypid JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace WHERE n.nspname = 'public' AND t.typname='enum_StockReservations_status' GROUP BY 1
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'StockReservations' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'StockReservations' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "orderId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "orderId" DROP DEFAULT;ALTER TABLE "StockReservations"  ADD UNIQUE ("orderId");ALTER TABLE "StockReservations" ALTER COLUMN "orderId" TYPE INTEGER  ;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "productId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "productId" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "productId" TYPE INTEGER;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "quantity" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" TYPE INTEGER;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "status" DROP NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "status" SET DEFAULT 'RESERVED';DO 'BEGIN CREATE TYPE "public"."enum_StockReservations_status" AS ENUM(''RESERVED'', ''CONFIRMED'', ''RELEASED''); EXCEPTION WHEN duplicate_object THEN null; END';ALTER TABLE "StockReservations" ALTER COLUMN "status" TYPE "public"."enum_StockReservations_status" USING ("status"::"public"."enum_StockReservations_status");
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" DROP CONSTRAINT "StockReservations_ProductId_fkey"
Executing (default): ALTER TABLE "StockReservations"  ADD FOREIGN KEY ("ProductId") REFERENCES "Products" ("id") ON DELETE SET NULL ON UPDATE CASCADE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'StockReservations' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'ProcessedEvents'
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'ProcessedEvents' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'ProcessedEvents' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" TYPE VARCHAR(255);
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'ProcessedEvents' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Database synced
Kafka producer connected for product-service
{"level":"INFO","timestamp":"2026-02-25T11:56:12.660Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
{"level":"INFO","timestamp":"2026-02-25T11:56:41.519Z","logger":"kafkajs","message":"[ConsumerGroup] Consumer has joined the group","groupId":"product-group","memberId":"kafkajs-70b34d36-756b-47f1-a472-1a8229a502f3","leaderId":"kafkajs-70b34d36-756b-47f1-a472-1a8229a502f3","isLeader":true,"memberAssignment":{"order-events":[0]},"groupProtocol":"RoundRobinAssigner","duration":28859}
Attempt 1 to start Kafka client failed, retrying in 1000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 2 to start Kafka client failed, retrying in 2000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 3 to start Kafka client failed, retrying in 4000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 4 to start Kafka client failed, retrying in 8000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 5 to start Kafka client failed, retrying in 16000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 6 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 7 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 8 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
Failed to start Kafka consumer after retries { error: 'Cannot subscribe to topic while consumer is running' }
Error starting Kafka consumer: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
    at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
    at startKafkaConsumer (/app/index.js:498:24)
    at runNextTicks (node:internal/process/task_queues:60:5)
    at process.processTimers (node:internal/timers:509:9)
    at async start (/app/index.js:538:5) {
  retriable: false,
  helpUrl: undefined,
  [cause]: undefined
}
Startup error: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
    at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
    at startKafkaConsumer (/app/index.js:498:24)
    at runNextTicks (node:internal/process/task_queues:60:5)
    at process.processTimers (node:internal/timers:509:9)
    at async start (/app/index.js:538:5) {
  retriable: false,
  helpUrl: undefined,
  [cause]: undefined
}

> product-service@1.0.0 start
> node index.js

[dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild
{"level":"WARN","timestamp":"2026-02-25T11:58:13.212Z","logger":"kafkajs","message":"KafkaJS v2.0.0 switched default partitioner. To retain the same partitioning behavior as in previous versions, create the producer with the option \"createPartitioner: Partitioners.LegacyPartitioner\". See the migration guide at https://kafka.js.org/docs/migration-guide-v2.0.0#producer-new-default-partitioner for details. Silence this warning by setting the environment variable \"KAFKAJS_NO_PARTITIONER_WARNING=1\""}
Product Service running on port 3002
Executing (default): SELECT 1+1 AS result
Database connected successfully
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'Products'
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'Products' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'Products' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "Products" ALTER COLUMN "name" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "name" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "name" TYPE VARCHAR(255);
Executing (default): ALTER TABLE "Products" ALTER COLUMN "stock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "stock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "stock" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "reservedStock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "reservedStock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "reservedStock" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "version" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "version" SET DEFAULT 1;ALTER TABLE "Products" ALTER COLUMN "version" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'Products' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'StockReservations'
Executing (default): SELECT t.typname enum_name, array_agg(e.enumlabel ORDER BY enumsortorder) enum_value FROM pg_type t JOIN pg_enum e ON t.oid = e.enumtypid JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace WHERE n.nspname = 'public' AND t.typname='enum_StockReservations_status' GROUP BY 1
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'StockReservations' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'StockReservations' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "orderId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "orderId" DROP DEFAULT;ALTER TABLE "StockReservations"  ADD UNIQUE ("orderId");ALTER TABLE "StockReservations" ALTER COLUMN "orderId" TYPE INTEGER  ;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "productId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "productId" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "productId" TYPE INTEGER;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "quantity" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" TYPE INTEGER;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "status" DROP NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "status" SET DEFAULT 'RESERVED';DO 'BEGIN CREATE TYPE "public"."enum_StockReservations_status" AS ENUM(''RESERVED'', ''CONFIRMED'', ''RELEASED''); EXCEPTION WHEN duplicate_object THEN null; END';ALTER TABLE "StockReservations" ALTER COLUMN "status" TYPE "public"."enum_StockReservations_status" USING ("status"::"public"."enum_StockReservations_status");
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" DROP CONSTRAINT "StockReservations_ProductId_fkey"
Executing (default): ALTER TABLE "StockReservations"  ADD FOREIGN KEY ("ProductId") REFERENCES "Products" ("id") ON DELETE SET NULL ON UPDATE CASCADE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'StockReservations' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'ProcessedEvents'
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'ProcessedEvents' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'ProcessedEvents' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" TYPE VARCHAR(255);
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'ProcessedEvents' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Database synced
Kafka producer connected for product-service
{"level":"INFO","timestamp":"2026-02-25T11:58:13.312Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
{"level":"INFO","timestamp":"2026-02-25T11:58:42.262Z","logger":"kafkajs","message":"[ConsumerGroup] Consumer has joined the group","groupId":"product-group","memberId":"kafkajs-ba9fa6a2-cc98-43ff-8d47-2ef05293dc9a","leaderId":"kafkajs-ba9fa6a2-cc98-43ff-8d47-2ef05293dc9a","isLeader":true,"memberAssignment":{"order-events":[0]},"groupProtocol":"RoundRobinAssigner","duration":28949}
Attempt 1 to start Kafka client failed, retrying in 1000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 2 to start Kafka client failed, retrying in 2000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 3 to start Kafka client failed, retrying in 4000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 4 to start Kafka client failed, retrying in 8000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 5 to start Kafka client failed, retrying in 16000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 6 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 7 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 8 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
Failed to start Kafka consumer after retries { error: 'Cannot subscribe to topic while consumer is running' }
Error starting Kafka consumer: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
    at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
    at startKafkaConsumer (/app/index.js:498:24)
    at async start (/app/index.js:538:5) {
  retriable: false,
  helpUrl: undefined,
  [cause]: undefined
}
Startup error: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
    at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
    at startKafkaConsumer (/app/index.js:498:24)
    at async start (/app/index.js:538:5) {
  retriable: false,
  helpUrl: undefined,
  [cause]: undefined
}

> product-service@1.0.0 start
> node index.js

[dotenv@17.2.3] injecting env (0) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com
{"level":"WARN","timestamp":"2026-02-25T12:00:14.233Z","logger":"kafkajs","message":"KafkaJS v2.0.0 switched default partitioner. To retain the same partitioning behavior as in previous versions, create the producer with the option \"createPartitioner: Partitioners.LegacyPartitioner\". See the migration guide at https://kafka.js.org/docs/migration-guide-v2.0.0#producer-new-default-partitioner for details. Silence this warning by setting the environment variable \"KAFKAJS_NO_PARTITIONER_WARNING=1\""}
Product Service running on port 3002
Executing (default): SELECT 1+1 AS result
Database connected successfully
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'Products'
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'Products' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'Products' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "Products" ALTER COLUMN "name" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "name" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "name" TYPE VARCHAR(255);
Executing (default): ALTER TABLE "Products" ALTER COLUMN "stock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "stock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "stock" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "reservedStock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "reservedStock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "reservedStock" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "version" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "version" SET DEFAULT 1;ALTER TABLE "Products" ALTER COLUMN "version" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'Products' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'StockReservations'
Executing (default): SELECT t.typname enum_name, array_agg(e.enumlabel ORDER BY enumsortorder) enum_value FROM pg_type t JOIN pg_enum e ON t.oid = e.enumtypid JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace WHERE n.nspname = 'public' AND t.typname='enum_StockReservations_status' GROUP BY 1
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'StockReservations' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'StockReservations' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "orderId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "orderId" DROP DEFAULT;ALTER TABLE "StockReservations"  ADD UNIQUE ("orderId");ALTER TABLE "StockReservations" ALTER COLUMN "orderId" TYPE INTEGER  ;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "productId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "productId" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "productId" TYPE INTEGER;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "quantity" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" TYPE INTEGER;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "status" DROP NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "status" SET DEFAULT 'RESERVED';DO 'BEGIN CREATE TYPE "public"."enum_StockReservations_status" AS ENUM(''RESERVED'', ''CONFIRMED'', ''RELEASED''); EXCEPTION WHEN duplicate_object THEN null; END';ALTER TABLE "StockReservations" ALTER COLUMN "status" TYPE "public"."enum_StockReservations_status" USING ("status"::"public"."enum_StockReservations_status");
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" DROP CONSTRAINT "StockReservations_ProductId_fkey"
Executing (default): ALTER TABLE "StockReservations"  ADD FOREIGN KEY ("ProductId") REFERENCES "Products" ("id") ON DELETE SET NULL ON UPDATE CASCADE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'StockReservations' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'ProcessedEvents'
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'ProcessedEvents' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'ProcessedEvents' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" TYPE VARCHAR(255);
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'ProcessedEvents' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Database synced
Kafka producer connected for product-service
{"level":"INFO","timestamp":"2026-02-25T12:00:14.350Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
{"level":"INFO","timestamp":"2026-02-25T12:00:42.994Z","logger":"kafkajs","message":"[ConsumerGroup] Consumer has joined the group","groupId":"product-group","memberId":"kafkajs-95896526-f3a8-4a67-ab56-ea7c469cbc36","leaderId":"kafkajs-95896526-f3a8-4a67-ab56-ea7c469cbc36","isLeader":true,"memberAssignment":{"order-events":[0]},"groupProtocol":"RoundRobinAssigner","duration":28643}
Attempt 1 to start Kafka client failed, retrying in 1000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 2 to start Kafka client failed, retrying in 2000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 3 to start Kafka client failed, retrying in 4000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 4 to start Kafka client failed, retrying in 8000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 5 to start Kafka client failed, retrying in 16000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 6 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 7 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 8 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
Failed to start Kafka consumer after retries { error: 'Cannot subscribe to topic while consumer is running' }
Error starting Kafka consumer: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
    at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
    at startKafkaConsumer (/app/index.js:498:24)
    at async start (/app/index.js:538:5) {
  retriable: false,
  helpUrl: undefined,
  [cause]: undefined
}
Startup error: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
    at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
    at startKafkaConsumer (/app/index.js:498:24)
    at async start (/app/index.js:538:5) {
  retriable: false,
  helpUrl: undefined,
  [cause]: undefined
}

> product-service@1.0.0 start
> node index.js

[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }
{"level":"WARN","timestamp":"2026-02-25T12:02:14.712Z","logger":"kafkajs","message":"KafkaJS v2.0.0 switched default partitioner. To retain the same partitioning behavior as in previous versions, create the producer with the option \"createPartitioner: Partitioners.LegacyPartitioner\". See the migration guide at https://kafka.js.org/docs/migration-guide-v2.0.0#producer-new-default-partitioner for details. Silence this warning by setting the environment variable \"KAFKAJS_NO_PARTITIONER_WARNING=1\""}
Product Service running on port 3002
Executing (default): SELECT 1+1 AS result
Database connected successfully
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'Products'
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'Products' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'Products' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "Products" ALTER COLUMN "name" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "name" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "name" TYPE VARCHAR(255);
Executing (default): ALTER TABLE "Products" ALTER COLUMN "stock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "stock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "stock" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "reservedStock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "reservedStock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "reservedStock" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "version" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "version" SET DEFAULT 1;ALTER TABLE "Products" ALTER COLUMN "version" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'Products' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'StockReservations'
Executing (default): SELECT t.typname enum_name, array_agg(e.enumlabel ORDER BY enumsortorder) enum_value FROM pg_type t JOIN pg_enum e ON t.oid = e.enumtypid JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace WHERE n.nspname = 'public' AND t.typname='enum_StockReservations_status' GROUP BY 1
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'StockReservations' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'StockReservations' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "orderId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "orderId" DROP DEFAULT;ALTER TABLE "StockReservations"  ADD UNIQUE ("orderId");ALTER TABLE "StockReservations" ALTER COLUMN "orderId" TYPE INTEGER  ;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "productId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "productId" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "productId" TYPE INTEGER;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "quantity" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" TYPE INTEGER;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "status" DROP NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "status" SET DEFAULT 'RESERVED';DO 'BEGIN CREATE TYPE "public"."enum_StockReservations_status" AS ENUM(''RESERVED'', ''CONFIRMED'', ''RELEASED''); EXCEPTION WHEN duplicate_object THEN null; END';ALTER TABLE "StockReservations" ALTER COLUMN "status" TYPE "public"."enum_StockReservations_status" USING ("status"::"public"."enum_StockReservations_status");
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" DROP CONSTRAINT "StockReservations_ProductId_fkey"
Executing (default): ALTER TABLE "StockReservations"  ADD FOREIGN KEY ("ProductId") REFERENCES "Products" ("id") ON DELETE SET NULL ON UPDATE CASCADE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'StockReservations' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'ProcessedEvents'
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'ProcessedEvents' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'ProcessedEvents' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" TYPE VARCHAR(255);
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'ProcessedEvents' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Database synced
Kafka producer connected for product-service
{"level":"INFO","timestamp":"2026-02-25T12:02:14.807Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
{"level":"INFO","timestamp":"2026-02-25T12:02:43.708Z","logger":"kafkajs","message":"[ConsumerGroup] Consumer has joined the group","groupId":"product-group","memberId":"kafkajs-0ece8492-2c8c-4684-9144-a1d5692ede2f","leaderId":"kafkajs-0ece8492-2c8c-4684-9144-a1d5692ede2f","isLeader":true,"memberAssignment":{"order-events":[0]},"groupProtocol":"RoundRobinAssigner","duration":28901}
Attempt 1 to start Kafka client failed, retrying in 1000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 2 to start Kafka client failed, retrying in 2000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 3 to start Kafka client failed, retrying in 4000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 4 to start Kafka client failed, retrying in 8000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 5 to start Kafka client failed, retrying in 16000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 6 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 7 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 8 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
Failed to start Kafka consumer after retries { error: 'Cannot subscribe to topic while consumer is running' }
Error starting Kafka consumer: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
    at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
    at startKafkaConsumer (/app/index.js:498:24)
    at runNextTicks (node:internal/process/task_queues:60:5)
    at process.processTimers (node:internal/timers:509:9)
    at async start (/app/index.js:538:5) {
  retriable: false,
  helpUrl: undefined,
  [cause]: undefined
}
Startup error: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
    at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
    at startKafkaConsumer (/app/index.js:498:24)
    at runNextTicks (node:internal/process/task_queues:60:5)
    at process.processTimers (node:internal/timers:509:9)
    at async start (/app/index.js:538:5) {
  retriable: false,
  helpUrl: undefined,
  [cause]: undefined
}

> product-service@1.0.0 start
> node index.js

[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }
{"level":"WARN","timestamp":"2026-02-25T12:04:15.560Z","logger":"kafkajs","message":"KafkaJS v2.0.0 switched default partitioner. To retain the same partitioning behavior as in previous versions, create the producer with the option \"createPartitioner: Partitioners.LegacyPartitioner\". See the migration guide at https://kafka.js.org/docs/migration-guide-v2.0.0#producer-new-default-partitioner for details. Silence this warning by setting the environment variable \"KAFKAJS_NO_PARTITIONER_WARNING=1\""}
Product Service running on port 3002
Executing (default): SELECT 1+1 AS result
Database connected successfully
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'Products'
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'Products' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'Products' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "Products" ALTER COLUMN "name" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "name" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "name" TYPE VARCHAR(255);
Executing (default): ALTER TABLE "Products" ALTER COLUMN "stock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "stock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "stock" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "reservedStock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "reservedStock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "reservedStock" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "version" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "version" SET DEFAULT 1;ALTER TABLE "Products" ALTER COLUMN "version" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'Products' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'StockReservations'
Executing (default): SELECT t.typname enum_name, array_agg(e.enumlabel ORDER BY enumsortorder) enum_value FROM pg_type t JOIN pg_enum e ON t.oid = e.enumtypid JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace WHERE n.nspname = 'public' AND t.typname='enum_StockReservations_status' GROUP BY 1
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'StockReservations' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'StockReservations' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "orderId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "orderId" DROP DEFAULT;ALTER TABLE "StockReservations"  ADD UNIQUE ("orderId");ALTER TABLE "StockReservations" ALTER COLUMN "orderId" TYPE INTEGER  ;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "productId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "productId" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "productId" TYPE INTEGER;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "quantity" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" TYPE INTEGER;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "status" DROP NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "status" SET DEFAULT 'RESERVED';DO 'BEGIN CREATE TYPE "public"."enum_StockReservations_status" AS ENUM(''RESERVED'', ''CONFIRMED'', ''RELEASED''); EXCEPTION WHEN duplicate_object THEN null; END';ALTER TABLE "StockReservations" ALTER COLUMN "status" TYPE "public"."enum_StockReservations_status" USING ("status"::"public"."enum_StockReservations_status");
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" DROP CONSTRAINT "StockReservations_ProductId_fkey"
Executing (default): ALTER TABLE "StockReservations"  ADD FOREIGN KEY ("ProductId") REFERENCES "Products" ("id") ON DELETE SET NULL ON UPDATE CASCADE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'StockReservations' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'ProcessedEvents'
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'ProcessedEvents' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'ProcessedEvents' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" TYPE VARCHAR(255);
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'ProcessedEvents' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Database synced
Kafka producer connected for product-service
{"level":"INFO","timestamp":"2026-02-25T12:04:15.667Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
{"level":"INFO","timestamp":"2026-02-25T12:04:44.416Z","logger":"kafkajs","message":"[ConsumerGroup] Consumer has joined the group","groupId":"product-group","memberId":"kafkajs-87d84a3a-47f5-4a88-9081-27b6e4260cbe","leaderId":"kafkajs-87d84a3a-47f5-4a88-9081-27b6e4260cbe","isLeader":true,"memberAssignment":{"order-events":[0]},"groupProtocol":"RoundRobinAssigner","duration":28749}
Attempt 1 to start Kafka client failed, retrying in 1000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 2 to start Kafka client failed, retrying in 2000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 3 to start Kafka client failed, retrying in 4000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 4 to start Kafka client failed, retrying in 8000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 5 to start Kafka client failed, retrying in 16000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 6 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 7 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 8 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
Failed to start Kafka consumer after retries { error: 'Cannot subscribe to topic while consumer is running' }
Error starting Kafka consumer: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
    at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
    at startKafkaConsumer (/app/index.js:498:24)
    at runNextTicks (node:internal/process/task_queues:60:5)
    at process.processTimers (node:internal/timers:509:9)
    at async start (/app/index.js:538:5) {
  retriable: false,
  helpUrl: undefined,
  [cause]: undefined
}
Startup error: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
    at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
    at startKafkaConsumer (/app/index.js:498:24)
    at runNextTicks (node:internal/process/task_queues:60:5)
    at process.processTimers (node:internal/timers:509:9)
    at async start (/app/index.js:538:5) {
  retriable: false,
  helpUrl: undefined,
  [cause]: undefined
}

> product-service@1.0.0 start
> node index.js

[dotenv@17.2.3] injecting env (0) from .env -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops
{"level":"WARN","timestamp":"2026-02-25T12:06:16.288Z","logger":"kafkajs","message":"KafkaJS v2.0.0 switched default partitioner. To retain the same partitioning behavior as in previous versions, create the producer with the option \"createPartitioner: Partitioners.LegacyPartitioner\". See the migration guide at https://kafka.js.org/docs/migration-guide-v2.0.0#producer-new-default-partitioner for details. Silence this warning by setting the environment variable \"KAFKAJS_NO_PARTITIONER_WARNING=1\""}
Product Service running on port 3002
Executing (default): SELECT 1+1 AS result
Database connected successfully
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'Products'
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'Products' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'Products' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "Products" ALTER COLUMN "name" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "name" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "name" TYPE VARCHAR(255);
Executing (default): ALTER TABLE "Products" ALTER COLUMN "stock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "stock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "stock" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "reservedStock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "reservedStock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "reservedStock" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "version" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "version" SET DEFAULT 1;ALTER TABLE "Products" ALTER COLUMN "version" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'Products' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'StockReservations'
Executing (default): SELECT t.typname enum_name, array_agg(e.enumlabel ORDER BY enumsortorder) enum_value FROM pg_type t JOIN pg_enum e ON t.oid = e.enumtypid JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace WHERE n.nspname = 'public' AND t.typname='enum_StockReservations_status' GROUP BY 1
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'StockReservations' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'StockReservations' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "orderId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "orderId" DROP DEFAULT;ALTER TABLE "StockReservations"  ADD UNIQUE ("orderId");ALTER TABLE "StockReservations" ALTER COLUMN "orderId" TYPE INTEGER  ;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "productId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "productId" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "productId" TYPE INTEGER;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "quantity" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" TYPE INTEGER;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "status" DROP NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "status" SET DEFAULT 'RESERVED';DO 'BEGIN CREATE TYPE "public"."enum_StockReservations_status" AS ENUM(''RESERVED'', ''CONFIRMED'', ''RELEASED''); EXCEPTION WHEN duplicate_object THEN null; END';ALTER TABLE "StockReservations" ALTER COLUMN "status" TYPE "public"."enum_StockReservations_status" USING ("status"::"public"."enum_StockReservations_status");
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" DROP CONSTRAINT "StockReservations_ProductId_fkey"
Executing (default): ALTER TABLE "StockReservations"  ADD FOREIGN KEY ("ProductId") REFERENCES "Products" ("id") ON DELETE SET NULL ON UPDATE CASCADE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'StockReservations' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'ProcessedEvents'
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'ProcessedEvents' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'ProcessedEvents' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" TYPE VARCHAR(255);
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'ProcessedEvents' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Database synced
Kafka producer connected for product-service
{"level":"INFO","timestamp":"2026-02-25T12:06:16.418Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
{"level":"INFO","timestamp":"2026-02-25T12:06:45.290Z","logger":"kafkajs","message":"[ConsumerGroup] Consumer has joined the group","groupId":"product-group","memberId":"kafkajs-9eccc8c6-83ad-4f15-8624-550d1925e2f4","leaderId":"kafkajs-9eccc8c6-83ad-4f15-8624-550d1925e2f4","isLeader":true,"memberAssignment":{"order-events":[0]},"groupProtocol":"RoundRobinAssigner","duration":28871}
Attempt 1 to start Kafka client failed, retrying in 1000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 2 to start Kafka client failed, retrying in 2000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 3 to start Kafka client failed, retrying in 4000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 4 to start Kafka client failed, retrying in 8000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 5 to start Kafka client failed, retrying in 16000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 6 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 7 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 8 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
Failed to start Kafka consumer after retries { error: 'Cannot subscribe to topic while consumer is running' }
Error starting Kafka consumer: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
    at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
    at startKafkaConsumer (/app/index.js:498:24)
    at async start (/app/index.js:538:5) {
  retriable: false,
  helpUrl: undefined,
  [cause]: undefined
}
Startup error: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
    at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
    at startKafkaConsumer (/app/index.js:498:24)
    at async start (/app/index.js:538:5) {
  retriable: false,
  helpUrl: undefined,
  [cause]: undefined
}

> product-service@1.0.0 start
> node index.js

[dotenv@17.2.3] injecting env (0) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com
{"level":"WARN","timestamp":"2026-02-25T12:08:17.162Z","logger":"kafkajs","message":"KafkaJS v2.0.0 switched default partitioner. To retain the same partitioning behavior as in previous versions, create the producer with the option \"createPartitioner: Partitioners.LegacyPartitioner\". See the migration guide at https://kafka.js.org/docs/migration-guide-v2.0.0#producer-new-default-partitioner for details. Silence this warning by setting the environment variable \"KAFKAJS_NO_PARTITIONER_WARNING=1\""}
Product Service running on port 3002
Executing (default): SELECT 1+1 AS result
Database connected successfully
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'Products'
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'Products' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'Products' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "Products" ALTER COLUMN "name" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "name" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "name" TYPE VARCHAR(255);
Executing (default): ALTER TABLE "Products" ALTER COLUMN "stock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "stock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "stock" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "reservedStock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "reservedStock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "reservedStock" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "version" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "version" SET DEFAULT 1;ALTER TABLE "Products" ALTER COLUMN "version" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'Products' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'StockReservations'
Executing (default): SELECT t.typname enum_name, array_agg(e.enumlabel ORDER BY enumsortorder) enum_value FROM pg_type t JOIN pg_enum e ON t.oid = e.enumtypid JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace WHERE n.nspname = 'public' AND t.typname='enum_StockReservations_status' GROUP BY 1
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'StockReservations' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'StockReservations' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "orderId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "orderId" DROP DEFAULT;ALTER TABLE "StockReservations"  ADD UNIQUE ("orderId");ALTER TABLE "StockReservations" ALTER COLUMN "orderId" TYPE INTEGER  ;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "productId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "productId" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "productId" TYPE INTEGER;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "quantity" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" TYPE INTEGER;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "status" DROP NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "status" SET DEFAULT 'RESERVED';DO 'BEGIN CREATE TYPE "public"."enum_StockReservations_status" AS ENUM(''RESERVED'', ''CONFIRMED'', ''RELEASED''); EXCEPTION WHEN duplicate_object THEN null; END';ALTER TABLE "StockReservations" ALTER COLUMN "status" TYPE "public"."enum_StockReservations_status" USING ("status"::"public"."enum_StockReservations_status");
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" DROP CONSTRAINT "StockReservations_ProductId_fkey"
Executing (default): ALTER TABLE "StockReservations"  ADD FOREIGN KEY ("ProductId") REFERENCES "Products" ("id") ON DELETE SET NULL ON UPDATE CASCADE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'StockReservations' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'ProcessedEvents'
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'ProcessedEvents' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'ProcessedEvents' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" TYPE VARCHAR(255);
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'ProcessedEvents' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Database synced
Kafka producer connected for product-service
{"level":"INFO","timestamp":"2026-02-25T12:08:17.276Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
{"level":"INFO","timestamp":"2026-02-25T12:08:45.907Z","logger":"kafkajs","message":"[ConsumerGroup] Consumer has joined the group","groupId":"product-group","memberId":"kafkajs-19fff72d-85ca-49e7-9e70-67c175845fd1","leaderId":"kafkajs-19fff72d-85ca-49e7-9e70-67c175845fd1","isLeader":true,"memberAssignment":{"order-events":[0]},"groupProtocol":"RoundRobinAssigner","duration":28630}
Attempt 1 to start Kafka client failed, retrying in 1000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 2 to start Kafka client failed, retrying in 2000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 3 to start Kafka client failed, retrying in 4000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 4 to start Kafka client failed, retrying in 8000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 5 to start Kafka client failed, retrying in 16000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 6 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 7 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 8 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
Failed to start Kafka consumer after retries { error: 'Cannot subscribe to topic while consumer is running' }
Error starting Kafka consumer: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
    at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
    at startKafkaConsumer (/app/index.js:498:24)
    at async start (/app/index.js:538:5) {
  retriable: false,
  helpUrl: undefined,
  [cause]: undefined
}
Startup error: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
    at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
    at startKafkaConsumer (/app/index.js:498:24)
    at async start (/app/index.js:538:5) {
  retriable: false,
  helpUrl: undefined,
  [cause]: undefined
}

> product-service@1.0.0 start
> node index.js

[dotenv@17.2.3] injecting env (0) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com
{"level":"WARN","timestamp":"2026-02-25T12:10:17.620Z","logger":"kafkajs","message":"KafkaJS v2.0.0 switched default partitioner. To retain the same partitioning behavior as in previous versions, create the producer with the option \"createPartitioner: Partitioners.LegacyPartitioner\". See the migration guide at https://kafka.js.org/docs/migration-guide-v2.0.0#producer-new-default-partitioner for details. Silence this warning by setting the environment variable \"KAFKAJS_NO_PARTITIONER_WARNING=1\""}
Product Service running on port 3002
Executing (default): SELECT 1+1 AS result
Database connected successfully
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'Products'
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'Products' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'Products' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "Products" ALTER COLUMN "name" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "name" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "name" TYPE VARCHAR(255);
Executing (default): ALTER TABLE "Products" ALTER COLUMN "stock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "stock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "stock" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "reservedStock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "reservedStock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "reservedStock" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "version" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "version" SET DEFAULT 1;ALTER TABLE "Products" ALTER COLUMN "version" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'Products' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'StockReservations'
Executing (default): SELECT t.typname enum_name, array_agg(e.enumlabel ORDER BY enumsortorder) enum_value FROM pg_type t JOIN pg_enum e ON t.oid = e.enumtypid JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace WHERE n.nspname = 'public' AND t.typname='enum_StockReservations_status' GROUP BY 1
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'StockReservations' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'StockReservations' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "orderId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "orderId" DROP DEFAULT;ALTER TABLE "StockReservations"  ADD UNIQUE ("orderId");ALTER TABLE "StockReservations" ALTER COLUMN "orderId" TYPE INTEGER  ;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "productId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "productId" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "productId" TYPE INTEGER;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "quantity" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" TYPE INTEGER;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "status" DROP NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "status" SET DEFAULT 'RESERVED';DO 'BEGIN CREATE TYPE "public"."enum_StockReservations_status" AS ENUM(''RESERVED'', ''CONFIRMED'', ''RELEASED''); EXCEPTION WHEN duplicate_object THEN null; END';ALTER TABLE "StockReservations" ALTER COLUMN "status" TYPE "public"."enum_StockReservations_status" USING ("status"::"public"."enum_StockReservations_status");
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" DROP CONSTRAINT "StockReservations_ProductId_fkey"
Executing (default): ALTER TABLE "StockReservations"  ADD FOREIGN KEY ("ProductId") REFERENCES "Products" ("id") ON DELETE SET NULL ON UPDATE CASCADE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'StockReservations' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'ProcessedEvents'
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'ProcessedEvents' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'ProcessedEvents' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" TYPE VARCHAR(255);
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'ProcessedEvents' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Database synced
Kafka producer connected for product-service
{"level":"INFO","timestamp":"2026-02-25T12:10:17.734Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
{"level":"INFO","timestamp":"2026-02-25T12:10:46.651Z","logger":"kafkajs","message":"[ConsumerGroup] Consumer has joined the group","groupId":"product-group","memberId":"kafkajs-24b218aa-edcc-4077-b598-b0ae75a47b97","leaderId":"kafkajs-24b218aa-edcc-4077-b598-b0ae75a47b97","isLeader":true,"memberAssignment":{"order-events":[0]},"groupProtocol":"RoundRobinAssigner","duration":28916}
Attempt 1 to start Kafka client failed, retrying in 1000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 2 to start Kafka client failed, retrying in 2000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 3 to start Kafka client failed, retrying in 4000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 4 to start Kafka client failed, retrying in 8000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 5 to start Kafka client failed, retrying in 16000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 6 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 7 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
{"level":"WARN","timestamp":"2026-02-25T13:39:16.262Z","logger":"kafkajs","message":"[RequestQueue] Response without match","clientId":"kafkajs","broker":"kafka:9092","correlationId":12}
Kafka producer connected for product-service
Attempt 8 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
Failed to start Kafka consumer after retries { error: 'Cannot subscribe to topic while consumer is running' }
Error starting Kafka consumer: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
    at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
    at startKafkaConsumer (/app/index.js:498:24)
    at async start (/app/index.js:538:5) {
  retriable: false,
  helpUrl: undefined,
  [cause]: undefined
}
Startup error: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
    at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
    at startKafkaConsumer (/app/index.js:498:24)
    at async start (/app/index.js:538:5) {
  retriable: false,
  helpUrl: undefined,
  [cause]: undefined
}

> product-service@1.0.0 start
> node index.js

[dotenv@17.2.3] injecting env (0) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`
{"level":"WARN","timestamp":"2026-02-25T13:39:41.971Z","logger":"kafkajs","message":"KafkaJS v2.0.0 switched default partitioner. To retain the same partitioning behavior as in previous versions, create the producer with the option \"createPartitioner: Partitioners.LegacyPartitioner\". See the migration guide at https://kafka.js.org/docs/migration-guide-v2.0.0#producer-new-default-partitioner for details. Silence this warning by setting the environment variable \"KAFKAJS_NO_PARTITIONER_WARNING=1\""}
Product Service running on port 3002
Executing (default): SELECT 1+1 AS result
Database connected successfully
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'Products'
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'Products' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'Products' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "Products" ALTER COLUMN "name" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "name" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "name" TYPE VARCHAR(255);
Executing (default): ALTER TABLE "Products" ALTER COLUMN "stock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "stock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "stock" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "reservedStock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "reservedStock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "reservedStock" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "version" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "version" SET DEFAULT 1;ALTER TABLE "Products" ALTER COLUMN "version" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'Products' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'StockReservations'
Executing (default): SELECT t.typname enum_name, array_agg(e.enumlabel ORDER BY enumsortorder) enum_value FROM pg_type t JOIN pg_enum e ON t.oid = e.enumtypid JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace WHERE n.nspname = 'public' AND t.typname='enum_StockReservations_status' GROUP BY 1
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'StockReservations' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'StockReservations' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "orderId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "orderId" DROP DEFAULT;ALTER TABLE "StockReservations"  ADD UNIQUE ("orderId");ALTER TABLE "StockReservations" ALTER COLUMN "orderId" TYPE INTEGER  ;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "productId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "productId" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "productId" TYPE INTEGER;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "quantity" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" TYPE INTEGER;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "status" DROP NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "status" SET DEFAULT 'RESERVED';DO 'BEGIN CREATE TYPE "public"."enum_StockReservations_status" AS ENUM(''RESERVED'', ''CONFIRMED'', ''RELEASED''); EXCEPTION WHEN duplicate_object THEN null; END';ALTER TABLE "StockReservations" ALTER COLUMN "status" TYPE "public"."enum_StockReservations_status" USING ("status"::"public"."enum_StockReservations_status");
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" DROP CONSTRAINT "StockReservations_ProductId_fkey"
Executing (default): ALTER TABLE "StockReservations"  ADD FOREIGN KEY ("ProductId") REFERENCES "Products" ("id") ON DELETE SET NULL ON UPDATE CASCADE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'StockReservations' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'ProcessedEvents'
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'ProcessedEvents' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'ProcessedEvents' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" TYPE VARCHAR(255);
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'ProcessedEvents' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Database synced
Kafka producer connected for product-service
{"level":"INFO","timestamp":"2026-02-25T13:39:42.516Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
{"level":"INFO","timestamp":"2026-02-25T13:40:06.894Z","logger":"kafkajs","message":"[ConsumerGroup] Consumer has joined the group","groupId":"product-group","memberId":"kafkajs-d35adf07-45d6-45fe-8111-5c9f395944bb","leaderId":"kafkajs-d35adf07-45d6-45fe-8111-5c9f395944bb","isLeader":true,"memberAssignment":{"order-events":[0]},"groupProtocol":"RoundRobinAssigner","duration":24376}
Attempt 1 to start Kafka client failed, retrying in 1000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 2 to start Kafka client failed, retrying in 2000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 3 to start Kafka client failed, retrying in 4000ms { error: 'Cannot subscribe to topic while consumer is running' }
{"level":"WARN","timestamp":"2026-02-25T14:12:54.707Z","logger":"kafkajs","message":"[RequestQueue] Response without match","clientId":"kafkajs","broker":"kafka:9092","correlationId":0}
Kafka producer connected for product-service
Attempt 4 to start Kafka client failed, retrying in 8000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 5 to start Kafka client failed, retrying in 16000ms { error: 'Cannot subscribe to topic while consumer is running' }
Kafka producer connected for product-service
Attempt 6 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
{"level":"WARN","timestamp":"2026-02-25T15:13:57.498Z","logger":"kafkajs","message":"[RequestQueue] Response without match","clientId":"kafkajs","broker":"kafka:9092","correlationId":6}
Kafka producer connected for product-service
Attempt 7 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
{"level":"WARN","timestamp":"2026-02-25T16:15:00.921Z","logger":"kafkajs","message":"[RequestQueue] Response without match","clientId":"kafkajs","broker":"kafka:9092","correlationId":12}
Kafka producer connected for product-service
Attempt 8 to start Kafka client failed, retrying in 30000ms { error: 'Cannot subscribe to topic while consumer is running' }
Failed to start Kafka consumer after retries { error: 'Cannot subscribe to topic while consumer is running' }
Error starting Kafka consumer: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
    at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
    at startKafkaConsumer (/app/index.js:498:24)
    at async start (/app/index.js:538:5) {
  retriable: false,
  helpUrl: undefined,
  [cause]: undefined
}
Startup error: KafkaJSNonRetriableError: Cannot subscribe to topic while consumer is running
    at Object.subscribe (/app/node_modules/kafkajs/src/consumer/index.js:136:13)
    at startKafkaConsumer (/app/index.js:498:24)
    at async start (/app/index.js:538:5) {
  retriable: false,
  helpUrl: undefined,
  [cause]: undefined
}

> product-service@1.0.0 start
> node index.js

[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops
{"level":"WARN","timestamp":"2026-02-25T16:15:26.804Z","logger":"kafkajs","message":"KafkaJS v2.0.0 switched default partitioner. To retain the same partitioning behavior as in previous versions, create the producer with the option \"createPartitioner: Partitioners.LegacyPartitioner\". See the migration guide at https://kafka.js.org/docs/migration-guide-v2.0.0#producer-new-default-partitioner for details. Silence this warning by setting the environment variable \"KAFKAJS_NO_PARTITIONER_WARNING=1\""}
Product Service running on port 3002
Executing (default): SELECT 1+1 AS result
Database connected successfully
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'Products'
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'Products' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'Products' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "Products" ALTER COLUMN "name" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "name" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "name" TYPE VARCHAR(255);
Executing (default): ALTER TABLE "Products" ALTER COLUMN "stock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "stock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "stock" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "reservedStock" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "reservedStock" SET DEFAULT 0;ALTER TABLE "Products" ALTER COLUMN "reservedStock" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "version" DROP NOT NULL;ALTER TABLE "Products" ALTER COLUMN "version" SET DEFAULT 1;ALTER TABLE "Products" ALTER COLUMN "version" TYPE INTEGER;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "Products" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "Products" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "Products" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'Products' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'StockReservations'
Executing (default): SELECT t.typname enum_name, array_agg(e.enumlabel ORDER BY enumsortorder) enum_value FROM pg_type t JOIN pg_enum e ON t.oid = e.enumtypid JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace WHERE n.nspname = 'public' AND t.typname='enum_StockReservations_status' GROUP BY 1
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'StockReservations' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'StockReservations' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "orderId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "orderId" DROP DEFAULT;ALTER TABLE "StockReservations"  ADD UNIQUE ("orderId");ALTER TABLE "StockReservations" ALTER COLUMN "orderId" TYPE INTEGER  ;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "productId" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "productId" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "productId" TYPE INTEGER;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "quantity" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "quantity" TYPE INTEGER;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "status" DROP NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "status" SET DEFAULT 'RESERVED';DO 'BEGIN CREATE TYPE "public"."enum_StockReservations_status" AS ENUM(''RESERVED'', ''CONFIRMED'', ''RELEASED''); EXCEPTION WHEN duplicate_object THEN null; END';ALTER TABLE "StockReservations" ALTER COLUMN "status" TYPE "public"."enum_StockReservations_status" USING ("status"::"public"."enum_StockReservations_status");
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "expiresAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "StockReservations" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "StockReservations" DROP CONSTRAINT "StockReservations_ProductId_fkey"
Executing (default): ALTER TABLE "StockReservations"  ADD FOREIGN KEY ("ProductId") REFERENCES "Products" ("id") ON DELETE SET NULL ON UPDATE CASCADE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'StockReservations' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Executing (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'ProcessedEvents'
Executing (default): SELECT pk.constraint_type as "Constraint",c.column_name as "Field", c.column_default as "Default",c.is_nullable as "Null", (CASE WHEN c.udt_name = 'hstore' THEN c.udt_name ELSE c.data_type END) || (CASE WHEN c.character_maximum_length IS NOT NULL THEN '(' || c.character_maximum_length || ')' ELSE '' END) as "Type", (SELECT array_agg(e.enumlabel) FROM pg_catalog.pg_type t JOIN pg_catalog.pg_enum e ON t.oid=e.enumtypid WHERE t.typname=c.udt_name) AS "special", (SELECT pgd.description FROM pg_catalog.pg_statio_all_tables AS st INNER JOIN pg_catalog.pg_description pgd on (pgd.objoid=st.relid) WHERE c.ordinal_position=pgd.objsubid AND c.table_name=st.relname) AS "Comment" FROM information_schema.columns c LEFT JOIN (SELECT tc.table_schema, tc.table_name, cu.column_name, tc.constraint_type FROM information_schema.TABLE_CONSTRAINTS tc JOIN information_schema.KEY_COLUMN_USAGE  cu ON tc.table_schema=cu.table_schema and tc.table_name=cu.table_name and tc.constraint_name=cu.constraint_name and tc.constraint_type='PRIMARY KEY') pk ON pk.table_schema=c.table_schema AND pk.table_name=c.table_name AND pk.column_name=c.column_name WHERE c.table_name = 'ProcessedEvents' AND c.table_schema = 'public'
Executing (default): SELECT DISTINCT tc.constraint_name as constraint_name, tc.constraint_schema as constraint_schema, tc.constraint_catalog as constraint_catalog, tc.table_name as table_name,tc.table_schema as table_schema,tc.table_catalog as table_catalog,tc.initially_deferred as initially_deferred,tc.is_deferrable as is_deferrable,kcu.column_name as column_name,ccu.table_schema  AS referenced_table_schema,ccu.table_catalog  AS referenced_table_catalog,ccu.table_name  AS referenced_table_name,ccu.column_name AS referenced_column_name FROM information_schema.table_constraints AS tc JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name WHERE constraint_type = 'FOREIGN KEY' AND tc.table_name = 'ProcessedEvents' AND tc.table_catalog = 'products_db'
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "eventType" TYPE VARCHAR(255);
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "processedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "createdAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" SET NOT NULL;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" DROP DEFAULT;ALTER TABLE "ProcessedEvents" ALTER COLUMN "updatedAt" TYPE TIMESTAMP WITH TIME ZONE;
Executing (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'ProcessedEvents' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
Database synced
Kafka producer connected for product-service
{"level":"INFO","timestamp":"2026-02-25T16:15:26.908Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
{"level":"ERROR","timestamp":"2026-02-25T17:15:43.233Z","logger":"kafkajs","message":"[Consumer] Crash: KafkaJSRequestTimeoutError: Request JoinGroup(key: 11, version: 5) timed out","groupId":"product-group","stack":"KafkaJSRequestTimeoutError: Request JoinGroup(key: 11, version: 5) timed out\n    at SocketRequest.timeoutRequest (/app/node_modules/kafkajs/src/network/requestQueue/socketRequest.js:107:19)\n    at /app/node_modules/kafkajs/src/network/requestQueue/index.js:94:21\n    at Map.forEach (<anonymous>)\n    at Timeout._onTimeout (/app/node_modules/kafkajs/src/network/requestQueue/index.js:92:23)\n    at listOnTimeout (node:internal/timers:569:17)\n    at process.processTimers (node:internal/timers:512:7)"}
{"level":"INFO","timestamp":"2026-02-25T17:15:43.234Z","logger":"kafkajs","message":"[Consumer] Stopped","groupId":"product-group"}
{"level":"ERROR","timestamp":"2026-02-25T17:15:43.235Z","logger":"kafkajs","message":"[Consumer] Restarting the consumer in 300ms","retryTime":300,"groupId":"product-group"}
{"level":"INFO","timestamp":"2026-02-25T17:15:43.245Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
{"level":"INFO","timestamp":"2026-02-25T17:15:43.535Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
{"level":"WARN","timestamp":"2026-02-25T17:16:04.440Z","logger":"kafkajs","message":"[RequestQueue] Response without match","clientId":"kafkajs","broker":"kafka:9092","correlationId":4}
{"level":"ERROR","timestamp":"2026-02-25T17:16:04.447Z","logger":"kafkajs","message":"[Consumer] Crash: KafkaJSConnectionClosedError: Closed connection","groupId":"product-group","stack":"KafkaJSConnectionClosedError: Closed connection\n    at Socket.onEnd (/app/node_modules/kafkajs/src/network/connection.js:197:13)\n    at Socket.emit (node:events:529:35)\n    at endReadableNT (node:internal/streams/readable:1400:12)\n    at process.processTicksAndRejections (node:internal/process/task_queues:82:21)"}
{"level":"INFO","timestamp":"2026-02-25T17:16:04.448Z","logger":"kafkajs","message":"[Consumer] Stopped","groupId":"product-group"}
{"level":"INFO","timestamp":"2026-02-25T17:16:04.449Z","logger":"kafkajs","message":"[Consumer] Stopped","groupId":"product-group"}
{"level":"ERROR","timestamp":"2026-02-25T17:16:04.449Z","logger":"kafkajs","message":"[Consumer] Crash: KafkaJSGroupCoordinatorNotFound: Failed to find group coordinator","groupId":"product-group","stack":"KafkaJSGroupCoordinatorNotFound: Failed to find group coordinator\n    at Cluster.findGroupCoordinatorMetadata (/app/node_modules/kafkajs/src/cluster/index.js:420:11)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async /app/node_modules/kafkajs/src/cluster/index.js:346:33\n    at async [private:ConsumerGroup:join] (/app/node_modules/kafkajs/src/consumer/consumerGroup.js:167:24)\n    at async /app/node_modules/kafkajs/src/consumer/consumerGroup.js:335:9\n    at async Runner.start (/app/node_modules/kafkajs/src/consumer/runner.js:84:7)\n    at async start (/app/node_modules/kafkajs/src/consumer/index.js:243:7)"}
{"level":"ERROR","timestamp":"2026-02-25T17:16:04.449Z","logger":"kafkajs","message":"[Consumer] Restarting the consumer in 300ms","retryTime":300,"groupId":"product-group"}
Kafka consumer started successfully
{"level":"WARN","timestamp":"2026-02-25T17:16:04.450Z","logger":"kafkajs","message":"[RequestQueue] Response without match","clientId":"kafkajs","broker":"kafka:9092","correlationId":8}
{"level":"WARN","timestamp":"2026-02-25T17:16:04.454Z","logger":"kafkajs","message":"[RequestQueue] Response without match","clientId":"kafkajs","broker":"kafka:9092","correlationId":9}
{"level":"INFO","timestamp":"2026-02-25T17:16:04.750Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
{"level":"ERROR","timestamp":"2026-02-25T17:49:29.468Z","logger":"kafkajs","message":"[Consumer] Crash: KafkaJSRequestTimeoutError: Request JoinGroup(key: 11, version: 5) timed out","groupId":"product-group","stack":"KafkaJSRequestTimeoutError: Request JoinGroup(key: 11, version: 5) timed out\n    at SocketRequest.timeoutRequest (/app/node_modules/kafkajs/src/network/requestQueue/socketRequest.js:107:19)\n    at /app/node_modules/kafkajs/src/network/requestQueue/index.js:94:21\n    at Map.forEach (<anonymous>)\n    at Timeout._onTimeout (/app/node_modules/kafkajs/src/network/requestQueue/index.js:92:23)\n    at listOnTimeout (node:internal/timers:569:17)\n    at process.processTimers (node:internal/timers:512:7)"}
{"level":"INFO","timestamp":"2026-02-25T17:49:29.469Z","logger":"kafkajs","message":"[Consumer] Stopped","groupId":"product-group"}
{"level":"ERROR","timestamp":"2026-02-25T17:49:29.469Z","logger":"kafkajs","message":"[Consumer] Restarting the consumer in 300ms","retryTime":300,"groupId":"product-group"}
{"level":"INFO","timestamp":"2026-02-25T17:49:29.769Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
{"level":"WARN","timestamp":"2026-02-25T17:49:50.781Z","logger":"kafkajs","message":"[RequestQueue] Response without match","clientId":"kafkajs","broker":"kafka:9092","correlationId":4}
{"level":"ERROR","timestamp":"2026-02-25T17:49:50.786Z","logger":"kafkajs","message":"[Consumer] Crash: KafkaJSConnectionClosedError: Closed connection","groupId":"product-group","stack":"KafkaJSConnectionClosedError: Closed connection\n    at Socket.onEnd (/app/node_modules/kafkajs/src/network/connection.js:197:13)\n    at Socket.emit (node:events:529:35)\n    at endReadableNT (node:internal/streams/readable:1400:12)\n    at process.processTicksAndRejections (node:internal/process/task_queues:82:21)"}
{"level":"INFO","timestamp":"2026-02-25T17:49:50.786Z","logger":"kafkajs","message":"[Consumer] Stopped","groupId":"product-group"}
{"level":"ERROR","timestamp":"2026-02-25T17:49:50.786Z","logger":"kafkajs","message":"[Consumer] Restarting the consumer in 300ms","retryTime":300,"groupId":"product-group"}
{"level":"WARN","timestamp":"2026-02-25T17:49:50.805Z","logger":"kafkajs","message":"[RequestQueue] Response without match","clientId":"kafkajs","broker":"kafka:9092","correlationId":10}
{"level":"INFO","timestamp":"2026-02-25T17:49:51.087Z","logger":"kafkajs","message":"[Consumer] Starting","groupId":"product-group"}
